<style>
    .bpp-logo-item:hover .bpp-logo {
        filter: grayscale(0%) drop-shadow(0 0 8px rgba(255, 150, 0, 0.8)) !important;
        cursor: pointer;
        transform: scale(1.1);
    }
</style>

<div class="title-bar" data-responsive-toggle="example-menu" data-hide-for="medium">
    <button class="menu-icon" type="button" data-toggle="example-menu"></button>
    <div class="title-bar-title hide-for-print">Menu</div>
</div>

<div class="top-bar stacked-for-medium hide-for-print sticky-header" id="example-menu">
    <div class="top-bar-left">
        <ul class="dropdown menu" data-dropdown-menu>
            <li class="menu-text bpp-logo-item"
                onclick="location.href='/';" style="padding: 0.5rem 0.5rem;">
                <img src="{% load static %}{% static 'images/bpp-icon.png' %}" alt="BPP" class="bpp-logo" style="height: 24px; width: auto; vertical-align: middle; filter: grayscale(100%); transition: filter 0.3s ease, transform 0.3s ease;">
            </li>
            <li><a href="{% url "multiseek:index" %}"><i class="fi-magnifying-glass" style="font-size: 1.6rem; margin-right: 0.4rem; vertical-align: middle;"></i> szukaj</a>
            </li>
            <li>
                <a href="#"><i class="fi-list" style="font-size: 1.6rem; margin-right: 0.4rem; vertical-align: middle;"></i> przeglądaj</a>
                <ul class="menu vertical">{% load deklinacja %}
                    <li><a href="/"><i class="fi-foundation" style="font-size: 1.6rem; margin-right: 0.8rem;"></i> {% rzeczownik_uczelnia %}</a></li>
                    <li><a href="{% url "bpp:browse_jednostki" %}"><i class="fi-results-demographics" style="font-size: 1.6rem; margin-right: 0.8rem;"></i> {% rzeczownik_jednostki_m %}</a></li>
                    <li><a href="{% url "bpp:browse_autorzy" %}"><i class="fi-torsos-all" style="font-size: 1.6rem; margin-right: 0.8rem;"></i> autorzy</a></li>
                    <li><a href="{% url "bpp:browse_zrodla" %}"><i class="fi-book" style="font-size: 1.6rem; margin-right: 0.8rem;"></i> źródła</a></li>
                </ul>
            </li>
            <li>
                <a href="#"><i class="fi-graph-trend" style="font-size: 1.6rem; margin-right: 0.4rem; vertical-align: middle;"></i> raporty</a>
                <ul class="menu vertical" id="top-bar-menu-raportow">
                    {% load czy_pokazywac %}
                    {% load user_in_group %}

                    {% if ENABLE_NEW_REPORTS %}
                        {% czy_pokazywac raport_uczelni %}
                            <li>
                                <a href="{% url "nowe_raporty:uczelnia_form" %}">
                                    <i class="fi-foundation" style="font-size: 1.6rem; margin-right: 0.8rem;"></i> raport uczelni
                                </a>
                            </li>
                        {% end_czy_pokazywac %}
                        {% czy_pokazywac raport_wydzialow %}
                            <li>
                                <a href="{% url "nowe_raporty:wydzial_form" %}">
                                    <i class="fi-results-demographics" style="font-size: 1.6rem; margin-right: 0.8rem;"></i> raport wydziałów
                                </a>
                            </li>
                        {% end_czy_pokazywac %}
                        {% czy_pokazywac raport_jednostek %}
                            <li>
                                <a href="{% url "nowe_raporty:jednostka_form" %}">
                                    <i class="fi-map" style="font-size: 1.6rem; margin-right: 0.8rem;"></i> raport jednostek
                                </a>
                            </li>
                        {% end_czy_pokazywac %}
                        {% czy_pokazywac raport_autorow %}
                            <li>
                                <a href="{% url "nowe_raporty:autor_form" %}">
                                    <i class="fi-torsos-all" style="font-size: 1.6rem; margin-right: 0.8rem;"></i> raport autorów
                                </a>
                            </li>
                        {% end_czy_pokazywac %}
                    {% endif %}
                    {% czy_pokazywac ranking_autorow %}
                        <hr/>
                        <li><a href="{% url "bpp:ranking_autorow_formularz" %}"><i class="fi-trophy" style="font-size: 1.6rem; margin-right: 0.8rem;"></i> ranking
                            autorów</a></li>
                        <hr>
                    {% end_czy_pokazywac %}

                </ul>
            </li>

            <script type="text/javascript">
                if (document.getElementById("top-bar-menu-raportow").firstElementChild.tagName == "HR") {
                    document.getElementById("top-bar-menu-raportow").firstElementChild.remove();
                }

                if (document.getElementById("top-bar-menu-raportow").lastElementChild.tagName == "HR") {
                    document.getElementById("top-bar-menu-raportow").lastElementChild.remove();
                }
            </script>

            <li>
                <a href="#"><i class="fi-graph-bar" style="font-size: 1.6rem; margin-right: 0.4rem; vertical-align: middle;"></i> ewaluacja</a>
                <ul class="menu vertical" id="top-bar-menu-ewaluacji">
                    {% load czy_pokazywac %}
                    {% load user_in_group %}

                    {% czy_pokazywac raport_slotow_autor %}
                        <li><a href="{% url "raport_slotow:index" %}"><i class="fi-torso" style="font-size: 1.6rem; margin-right: 0.8rem;"></i> raport slotów - autor</a></li>
                    {% end_czy_pokazywac %}
                    {% czy_pokazywac raport_slotow_zerowy %}
                        <li><a href="{% url "raport_slotow:raport-slotow-zerowy-parametry" %}"><i class="fi-clipboard-notes" style="font-size: 1.6rem; margin-right: 0.8rem;"></i> raport slotów -
                            zerowy</a>
                        </li>
                    {% end_czy_pokazywac %}

                    {% czy_pokazywac raport_slotow_uczelnia %}
                        <li><a href="{% url "raport_slotow:lista-raport-slotow-uczelnia" %}"><i class="fi-foundation" style="font-size: 1.6rem; margin-right: 0.8rem;"></i> raport slotów -
                            uczelnia</a></li>
                        <li><a href="{% url "raport_slotow:index-ewaluacja" %}"><i class="fi-clipboard-pencil" style="font-size: 1.6rem; margin-right: 0.8rem;"></i> raport slotów - ewaluacja</a>
                        <li><a href="{% url "raport_slotow:index-upowaznienia" %}"><i class="fi-shield" style="font-size: 1.6rem; margin-right: 0.8rem;"></i> raport ewaluacja -
                            upoważnienia</a>
                        <li><a href="{% url "ewaluacja2021:lista-raportow3n" %}"><i class="fi-page-multiple" style="font-size: 1.6rem; margin-right: 0.8rem;"></i> raport ewaluacja - 3N</a>
                        </li>
                        <li><a href="{% url "snapshot_odpiec:index" %}"><i class="fi-camera" style="font-size: 1.6rem; margin-right: 0.8rem;"></i> snapshoty odpięć</a></li>
                    {% end_czy_pokazywac %}

                </ul>
            </li>

            <script type="text/javascript">
                // Hide ewaluacja menu if it's empty
                var ewaluacjaMenu = document.getElementById("top-bar-menu-ewaluacji");
                if (ewaluacjaMenu && ewaluacjaMenu.children.length === 0) {
                    // Hide the parent <li> element that contains the menu
                    ewaluacjaMenu.parentElement.style.display = 'none';
                }
            </script>

            {% if not request.user.is_anonymous %}

                {% if request.user.is_superuser or request.user|has_group:"wprowadzanie danych" %}
                    {% if uczelnia.pbn_integracja %}
                        <li>
                            <a href="#"><i class="fi-link" style="font-size: 1.6rem; margin-right: 0.4rem; vertical-align: middle;"></i> PBN</a>
                            <ul class="menu vertical">
                                {% if request.user|has_group:"wprowadzanie danych" or request.user.is_superuser %}
                                    <li><a href="{% url "pbn_api:authorize" %}"><i class="fi-key" style="font-size: 1.6rem; margin-right: 0.8rem;"></i> autoryzuj PBN API</a></li>
                                    <li><a href="{% url "pbn_downloader_app:main" %}"><i class="fi-download" style="font-size: 1.6rem; margin-right: 0.8rem;"></i> pobieranie danych z PBN</a></li>
                                    <li><a href="{% url "komparator_pbn:main" %}"><i class="fi-arrows-compress" style="font-size: 1.6rem; margin-right: 0.8rem;"></i> komparator PBN</a></li>
                                    <li><a href="{% url "komparator_pbn_udzialy:list" %}"><i class="fi-alert" style="font-size: 1.6rem; margin-right: 0.8rem;"></i> komparator udziałów PBN</a></li>
                                    <li><a href="{% url "importer_autorow_pbn:main" %}"><i class="fi-torsos-female-male" style="font-size: 1.6rem; margin-right: 0.8rem;"></i> importer autorów PBN</a></li>
                                    <li><a href="{% url "deduplikator_autorow:duplicate_authors" %}"><i class="fi-filter" style="font-size: 1.6rem; margin-right: 0.8rem;"></i> deduplikator autorów PBN</a></li>
                                {% endif %}
                            </ul>
                        </li>
                    {% endif %}

                    <li class="has-submenu">
                        <a href="#" data-toggle><i class="fi-wrench" style="font-size: 1.6rem; margin-right: 0.4rem; vertical-align: middle;"></i> operacje</a>
                        <div class="menu-columns-wrapper" data-submenu>
                            {% if request.user|has_group:"wprowadzanie danych" or request.user.is_superuser %}
                                <ul class="menu vertical column-1">
                                    <li><a href="{% url "integrator2:main" %}"><i class="fi-upload" style="font-size: 1.6rem; margin-right: 0.8rem;"></i> import danych</a></li>
                                    <li><a href="{% url "import_pracownikow:index" %}"><i class="fi-torsos" style="font-size: 1.6rem; margin-right: 0.8rem;"></i> import pracowników</a></li>
                                    <li><a href="{% url "import_polon:index" %}"><i class="fi-database" style="font-size: 1.6rem; margin-right: 0.8rem;"></i> import z POLON</a></li>
                                    <li><a href="{% url "import_polon:index-absencji" %}"><i class="fi-calendar" style="font-size: 1.6rem; margin-right: 0.8rem;"></i> import absencji</a></li>
                                    <li><a href="{% url "import_list_ministerialnych:index" %}"><i class="fi-clipboard-notes" style="font-size: 1.6rem; margin-right: 0.8rem;"></i> import list
                                        ministerialnych</a></li>
{#                                    <li><a href="{% url "ewaluacja2021:lista-importow" %}">import udziałów dla#}
{#                                        autorów</a>#}
{#                                    </li>#}
                                    <li><a href="{% url "import_list_if:index" %}"><i class="fi-graph-bar" style="font-size: 1.6rem; margin-right: 0.8rem;"></i> import list IF</a></li>
                                    <li><a href="{% url "import_dyscyplin:index" %}"><i class="fi-folder" style="font-size: 1.6rem; margin-right: 0.8rem;"></i> import dyscyplin</a></li>
                                    <hr/>
                                    <li><a href="{% url "bpp:xlsx-issn-chunks" %}"><i class="fi-download" style="font-size: 1.6rem; margin-right: 0.8rem;"></i> eksport ISSNów</a></li>
                                </ul>
                                <ul class="menu vertical column-2">
                                    <li><a href="{% url "admin:rozbieznosci_dyscyplin_rozbieznosciview_changelist" %}">
                                        <i class="fi-alert" style="font-size: 1.6rem; margin-right: 0.8rem;"></i> rozbieżności dyscyplin</a></li>
                                    <li><a href="{% url "rozbieznosci_if:index" %}"><i class="fi-alert" style="font-size: 1.6rem; margin-right: 0.8rem;"></i> rozbieżności
                                        punktacji IF</a></li>
                                </ul>
                            {% endif %}
                        </div>
                    </li>
                {% endif %}

                {% if request.user.is_staff %}
                    <li><a target="_blank"
                           href="{% url "admin:index" %}"><i class="fi-pencil" style="font-size: 1.6rem; margin-right: 0.4rem; vertical-align: middle;"></i> redagowanie</a>
                    </li>
                {% endif %}

                <li>
                    <a href="#" onclick="document.getElementById('logout-form').submit(); return false;">
                        <i class="fi-power" style="font-size: 1.6rem; margin-right: 0.4rem; vertical-align: middle;"></i> wyloguj
                    </a>
                    <ul class="menu vertical">
                        <li>
                            <a href="#" onclick="document.getElementById('logout-form').submit(); return false;">
                                <i class="fi-power" style="font-size: 1.6rem; margin-right: 0.8rem;"></i> wyloguj
                            </a>
                        </li>
                        {% if not microsoft_login_enabled %}
                            <li><a id="password-change-link" href="{% url "password_change" %}"><i class="fi-key" style="font-size: 1.6rem; margin-right: 0.8rem;"></i> zmiana hasła</a></li>
                        {% endif %}
                        {% if request.user.is_superuser %}
                            <li><a href="/admin/bpp/bppuser/" target="_blank"><i class="fi-torso-business" style="font-size: 1.6rem; margin-right: 0.8rem;"></i> zaloguj jako inny użytkownik</a></li>
                        {% endif %}
                    </ul>
                </li>

                <!-- Hidden logout form -->
                <form id="logout-form" action="{% url "logout" %}" method="post" style="display: none;">
                    {% csrf_token %}
                </form>

            {% endif %}

            {% if request.user.is_anonymous %}
                {% if microsoft_login_enabled %}
                    <li>
                        <a href="#"><i class="fi-lock" style="font-size: 1.6rem; margin-right: 0.4rem; vertical-align: middle;"></i>
                        zaloguj</a>
                        <ul class="menu vertical">
                            <li><a href="{% url "microsoft_auth:to-auth-redirect" %}?next={{ request.get_full_path }}">
                                <i class="fi-torso" style="font-size: 1.6rem; margin-right: 0.8rem;"></i> logowanie</a></li>
                            <li><a href="/admin/">
                                <i class="fi-alert" style="font-size: 1.6rem; margin-right: 0.8rem;"></i> logowanie awaryjne</a></li>
                        </ul>
                    </li>
                {% else %}
                    <li><a href="{% url "login_form" %}?next={{ request.get_full_path }}">
                        <i class="fi-lock" style="font-size: 1.6rem; margin-right: 0.4rem; vertical-align: middle;"></i>
                        zaloguj</a></li>
                {% endif %}

            {% endif %}


        </ul>
    </div>
    <div class="top-bar-right">
        <ul class="dropdown menu" data-dropdown-menu>
            {% block global-nav %}
                <li class="global-nav-container">{% load crispy_forms_tags %}
                    {% crispy global_nav_form %}
                    <script type="text/javascript">
                        $(document).ready(function () {
                            // Function to scale global_nav based on window width
                            function scaleGlobalNav() {
                                const windowWidth = window.innerWidth;
                                const navContainer = $('#div_id_global_nav_value');
                                const select2Container = navContainer.find('.select2-container');

                                let navWidth;

                                // Calculate width based on window size
                                if (windowWidth < 640) {
                                    // Mobile
                                    navWidth = Math.min(windowWidth * 0.4, 200);
                                } else if (windowWidth < 1024) {
                                    // Tablet
                                    navWidth = Math.min(windowWidth * 0.35, 300);
                                } else if (windowWidth < 1440) {
                                    // Small desktop
                                    navWidth = Math.min(windowWidth * 0.25, 350);
                                } else {
                                    // Large desktop
                                    navWidth = Math.min(windowWidth * 0.4, 450);
                                }

                                // Apply the calculated width
                                navContainer.css({
                                    'min-width': navWidth + 'px',
                                    'width': navWidth + 'px'
                                });

                                select2Container.css({
                                    'min-width': navWidth + 'px',
                                    'width': navWidth + 'px'
                                });
                            }

                            // Initial scale
                            scaleGlobalNav();

                            // Scale on window resize with debouncing
                            let resizeTimer;
                            $(window).on('resize', function() {
                                clearTimeout(resizeTimer);
                                resizeTimer = setTimeout(scaleGlobalNav, 100);
                            });

                            // Original change handler
                            $(':input[name$=global_nav_value]').on('change', function () {
                                location.href = "/global-nav-redir/" + $(this).val() +
                                    "/?source=user";
                            });
                        });
                    </script>
                </li>
            {% endblock %}

        </ul>
    </div>
</div>
