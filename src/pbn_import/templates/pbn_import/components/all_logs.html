{% load pbn_import_tags %}

<h2 class="pbn-import__section-title">
    <span class="fi-list"></span>
    Wszystkie logi ({{ logs|length }})
</h2>
<div class="pbn-import__log-container">
    {% for log in logs %}
    <div class="pbn-import__log-entry">
        <span class="pbn-import__log-timestamp">{{ log.timestamp|date:"d.m.Y H:i:s" }}</span>
        <span class="pbn-import__log-level pbn-import__log-level--{{ log.level }}">{{ log.level }}</span>
        <span class="pbn-import__log-step">{{ log.step }}</span>
        <span class="pbn-import__log-message">
            {% if log|is_error_log and log.details %}
                {{ log.message|truncate_message:150 }}
                <button type="button"
                        class="pbn-import__error-details-toggle"
                        data-action="toggle-details">Pokaż szczegóły</button>
                <div class="pbn-import__log-message-expanded">
                    <strong>Pełna wiadomość:</strong>
                    <pre class="pbn-import__log-pre">{{ log.message }}</pre>
                    {% if log.details %}
                        <strong>Szczegóły techniczne:</strong>
                        {% if log.details.traceback %}
                            {% if user.is_superuser %}
                                <pre class="pbn-import__json-display">{{ log.details.traceback }}</pre>
                            {% else %}
                                <div class="pbn-import__traceback-restricted">
                                    <span class="fi-lock"></span>
                                    Traceback dostępny tylko dla superużytkowników
                                </div>
                            {% endif %}
                        {% else %}
                            {{ log.details|format_json }}
                        {% endif %}
                    {% endif %}
                </div>
            {% else %}
                {{ log.message }}
            {% endif %}
        </span>
    </div>
    {% empty %}
    <p class="text-muted">Brak logów</p>
    {% endfor %}
</div>
