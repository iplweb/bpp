{% extends "base.html" %}
{% load humanize %}
{% load static %}

{% block title %}Dwudyscyplinowcy{% endblock %}

{% block extra_css %}
<link rel="stylesheet"
      href="{% static 'ewaluacja_dwudyscyplinowcy/css/ewaluacja_dwudyscyplinowcy.css' %}">
{% endblock %}

{% block breadcrumbs %}
    {{ block.super }}
    <li><a href="/">Strona główna</a></li>
    <li><a href="{% url 'ewaluacja_optymalizacja:index' %}">Optymalizacja ewaluacji</a></li>
    <li class="current">Dwudyscyplinowcy</li>
{% endblock %}

{% block content %}
<div class="row">
    <div class="large-12 columns">
        <h1>
            <span class="fi-torsos-all"></span> Dwudyscyplinowcy ({{ lata }})
        </h1>

        <div class="callout secondary">
            <h4><span class="fi-info"></span> O module</h4>
            <p>
                Ten moduł pokazuje autorów, którzy mają przypisane <strong>dokładnie dwie dyscypliny</strong>
                (dyscyplina główna + subdyscyplina) w latach {{ lata }}.
            </p>
            <p>
                Dla każdego autora wyświetlane są publikacje ciągłe z oznaczeniem, czy subdyscyplina autora
                jest zgodna z dyscyplinami źródła publikacji:
            </p>
            <ul class="ewaluacja-dwudyscyplinowcy__info-list">
                <li><span class="fi-check ewaluacja-dwudyscyplinowcy__icon-check"></span>
                    <strong>Zielony znacznik</strong>
                    - subdyscyplina jest zgodna z dyscyplinami źródła</li>
                <li><span class="fi-x ewaluacja-dwudyscyplinowcy__icon-x"></span>
                    <strong>Szary znacznik</strong>
                    - subdyscyplina NIE jest zgodna z dyscyplinami źródła</li>
            </ul>
        </div>

        {% if liczba_autorow == 0 %}
        <div class="callout warning">
            <p>Brak autorów z dwiema dyscyplinami w latach {{ lata }}.</p>
        </div>
        {% else %}
        <div class="callout success">
            <h4><span class="fi-check"></span> Znaleziono {{ liczba_autorow }} autorów z dwiema dyscyplinami</h4>
        </div>

        {% for autor_data in autorzy_dane %}
        <div class="callout ewaluacja-dwudyscyplinowcy__author-card">
            <h3 class="ewaluacja-dwudyscyplinowcy__author-title">
                <span class="fi-torso"></span>
                {{ autor_data.autor }}
            </h3>

            <div class="ewaluacja-dwudyscyplinowcy__disciplines-section">
                <h5 class="ewaluacja-dwudyscyplinowcy__disciplines-heading">Dyscypliny:</h5>
                {% for disc_info in autor_data.dyscypliny_info %}
                <div class="ewaluacja-dwudyscyplinowcy__discipline-year">
                    <strong>Rok {{ disc_info.rok }}:</strong>
                    <ul class="ewaluacja-dwudyscyplinowcy__discipline-list">
                        <li>Dyscyplina główna: {{ disc_info.dyscyplina_glowna.nazwa }}
                            <code>({{ disc_info.dyscyplina_glowna.kod }})</code></li>
                        <li>Subdyscyplina: {{ disc_info.subdyscyplina.nazwa }}
                            <code>({{ disc_info.subdyscyplina.kod }})</code></li>
                    </ul>
                </div>
                {% endfor %}
            </div>

            <div class="ewaluacja-dwudyscyplinowcy__publications-summary">
                <strong>Publikacje:</strong> {{ autor_data.liczba_publikacji }}
                (<span class="ewaluacja-dwudyscyplinowcy__count-matched">{{ autor_data.liczba_zgodnych }} zgodnych</span>,
                <span class="ewaluacja-dwudyscyplinowcy__count-unmatched">{{ autor_data.liczba_niezgodnych }} niezgodnych</span>)
            </div>

            {% if autor_data.publikacje %}
            <table class="ewaluacja-dwudyscyplinowcy__table">
                <thead>
                    <tr>
                        <th width="50">Status</th>
                        <th width="60">Rok</th>
                        <th>Tytuł publikacji</th>
                        <th width="80">Sloty</th>
                        <th width="150">Akcje</th>
                    </tr>
                </thead>
                <tbody>
                    {% for pub in autor_data.publikacje %}
                    <tr>
                        <td class="ewaluacja-dwudyscyplinowcy__status-cell">
                            {% if pub.zgodna %}
                            <span class="fi-check ewaluacja-dwudyscyplinowcy__status-icon ewaluacja-dwudyscyplinowcy__status-icon--check"
                                  title="Subdyscyplina zgodna z dyscyplinami źródła"></span>
                            {% else %}
                            <span class="fi-x ewaluacja-dwudyscyplinowcy__status-icon ewaluacja-dwudyscyplinowcy__status-icon--x"
                                  title="Subdyscyplina NIE jest zgodna z dyscyplinami źródła"></span>
                            {% endif %}
                        </td>
                        <td>{{ pub.rok }}</td>
                        <td>
                            <a href="{% url 'bpp:browse_praca_by_slug' pub.rekord.slug %}"
                               target="_blank">
                                {{ pub.rekord.tytul_oryginalny }}
                            </a>
                        </td>
                        <td class="ewaluacja-dwudyscyplinowcy__slots-cell">
                            {% if pub.sloty %}
                                {{ pub.sloty|floatformat:4 }}
                            {% else %}
                                <span class="ewaluacja-dwudyscyplinowcy__no-slots">-</span>
                            {% endif %}
                        </td>
                        <td>
                            <a href="{% url 'ewaluacja_optymalizuj_publikacje:optymalizuj' pub.rekord.slug %}"
                               class="button tiny">
                                <span class="fi-wrench"></span> Optymalizuj
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <p class="ewaluacja-dwudyscyplinowcy__no-publications">
                Brak publikacji ciągłych.
            </p>
            {% endif %}
        </div>
        {% endfor %}

        {% endif %}

        <div class="ewaluacja-dwudyscyplinowcy__back-section">
            <a href="{% url 'ewaluacja_optymalizacja:index' %}" class="button secondary">
                <span class="fi-arrow-left"></span> Powrót do optymalizacji ewaluacji
            </a>
        </div>
    </div>
</div>
{% endblock %}
