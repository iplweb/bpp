{% extends "base.html" %}
{% load url_helpers %}

{% block title %}
    {{ page_title }}
{% endblock %}

{% block breadcrumbs %}
    {{ block.super }}
    <li class="current">{{ page_title }}</li>
{% endblock %}

{% block content %}
    <div class="row">
        <div class="medium-12 columns">
            <h1>{{ page_title }}</h1>
        </div>
    </div>

    <div class="row">
        <div class="medium-12 columns">
            <form method="get" class="callout {{ panel_class }}">
                <div class="row">
                    <div class="medium-2 columns">
                        <label>Rok od:
                            <input type="number" name="rok_od" value="{{ rok_od }}" min="1900" max="2100"
                                   style="width: 80px;">
                        </label>
                    </div>
                    <div class="medium-2 columns">
                        <label>Rok do:
                            <input type="number" name="rok_do" value="{{ rok_do }}" min="1900" max="2100"
                                   style="width: 80px;">
                        </label>
                    </div>
                    <div class="medium-4 columns">
                        <label>Tytuł:
                            <input type="text" name="tytul" value="{{ tytul }}"
                                   placeholder="Szukaj w tytule...">
                        </label>
                    </div>
                    <div class="medium-4 columns" style="padding-top: 1.5rem;">
                        <button type="submit" class="button">
                            <span class="fi-filter"></span> Filtruj
                        </button>
                        <a href="{% url 'rozbieznosci_if:index' %}" class="button secondary">
                            <span class="fi-x"></span> Resetuj
                        </a>
                    </div>
                </div>
                <div class="row">
                    <div class="medium-12 columns" style="padding-top: 0.5rem;">
                        {% if filter_query_string %}
                            <a href="{% url 'rozbieznosci_if:export' %}?{{ filter_query_string }}&sort={{ current_sort }}"
                               class="button success">
                                <span class="fi-download"></span> Eksport XLSX
                            </a>
                            <a href="{% url 'rozbieznosci_if:ustaw_wszystkie' %}?{{ filter_query_string }}"
                               class="button warning"
                               data-confirm="Czy na pewno chcesz zaktualizować {{ field_label }} dla wszystkich {{ page_obj.paginator.count }} rekordów?">
                                <span class="fi-check"></span> Ustaw wszystkie wg źródła
                            </a>
                        {% else %}
                            <a href="{% url 'rozbieznosci_if:export' %}?sort={{ current_sort }}"
                               class="button success">
                                <span class="fi-download"></span> Eksport XLSX
                            </a>
                            <a href="{% url 'rozbieznosci_if:ustaw_wszystkie' %}"
                               class="button warning"
                               data-confirm="Czy na pewno chcesz zaktualizować {{ field_label }} dla wszystkich {{ page_obj.paginator.count }} rekordów?">
                                <span class="fi-check"></span> Ustaw wszystkie wg źródła
                            </a>
                        {% endif %}
                    </div>
                </div>
            </form>
        </div>
    </div>

    <div class="row">
        <div class="medium-12 columns">
            <p>
                Znaleziono: <strong>{{ page_obj.paginator.count }}</strong> rekordów
                | <a href="{% url "admin:rozbieznosci_if_ignorujrozbieznoscif_changelist" %}">pokaż ignorowane rekordy</a>
            </p>
        </div>
    </div>

    {% include "pagination/pagination_with_anchor.html" %}

    <table>
        <thead>
            <tr>
                <th>Tytuł</th>
                <th>
                    {% if filter_query_string %}
                        <a href="?{{ filter_query_string }}&sort={% if current_sort == 'rok' %}-rok{% else %}rok{% endif %}">
                    {% else %}
                        <a href="?sort={% if current_sort == 'rok' %}-rok{% else %}rok{% endif %}">
                    {% endif %}
                        Rok
                        {% if current_sort == 'rok' %}
                            <span class="fi-arrow-up"></span>
                        {% elif current_sort == '-rok' %}
                            <span class="fi-arrow-down"></span>
                        {% endif %}
                    </a>
                </th>
                <th>Źródło</th>
                <th>
                    {% if filter_query_string %}
                        <a href="?{{ filter_query_string }}&sort={% if current_sort == sort_field %}-{{ sort_field }}{% else %}{{ sort_field }}{% endif %}">
                    {% else %}
                        <a href="?sort={% if current_sort == sort_field %}-{{ sort_field }}{% else %}{{ sort_field }}{% endif %}">
                    {% endif %}
                        {{ field_label_pracy }}
                        {% if current_sort == sort_field %}
                            <span class="fi-arrow-up"></span>
                        {% elif current_sort == sort_field_desc %}
                            <span class="fi-arrow-down"></span>
                        {% endif %}
                    </a>
                </th>
                <th>
                    {% if filter_query_string %}
                        <a href="?{{ filter_query_string }}&sort={% if current_sort == sort_field_zrodla %}-{{ sort_field_zrodla }}{% else %}{{ sort_field_zrodla }}{% endif %}">
                    {% else %}
                        <a href="?sort={% if current_sort == sort_field_zrodla %}-{{ sort_field_zrodla }}{% else %}{{ sort_field_zrodla }}{% endif %}">
                    {% endif %}
                        {{ field_label_zrodla }}
                        {% if current_sort == sort_field_zrodla %}
                            <span class="fi-arrow-up"></span>
                        {% elif current_sort == sort_field_zrodla_desc %}
                            <span class="fi-arrow-down"></span>
                        {% endif %}
                    </a>
                </th>
                <th>
                    {% if filter_query_string %}
                        <a href="?{{ filter_query_string }}&sort={% if current_sort == 'ostatnio_zmieniony' %}-ostatnio_zmieniony{% else %}ostatnio_zmieniony{% endif %}">
                    {% else %}
                        <a href="?sort={% if current_sort == 'ostatnio_zmieniony' %}-ostatnio_zmieniony{% else %}ostatnio_zmieniony{% endif %}">
                    {% endif %}
                        Ost. zmieniony
                        {% if current_sort == 'ostatnio_zmieniony' %}
                            <span class="fi-arrow-up"></span>
                        {% elif current_sort == '-ostatnio_zmieniony' %}
                            <span class="fi-arrow-down"></span>
                        {% endif %}
                    </a>
                </th>
                <th>Operacje</th>
            </tr>
        </thead>
        <tbody>
            {% for elem in object_list %}
                <tr>
                    <td style="font-size: 0.85em;"><a href="{% url "admin:bpp_wydawnictwo_ciagle_change" elem.pk %}">
                        {{ elem.opis_bibliograficzny_cache|safe }}
                    </a>
                    </td>
                    <td>{{ elem.rok }}</td>
                    <td>
                        <a href="{% url "admin:bpp_zrodlo_change" elem.zrodlo.pk %}">
                            {{ elem.zrodlo.nazwa|safe }}
                        </a>
                    </td>
                    <td>
                        {{ elem.impact_factor }}
                    </td>
                    <td>
                        {{ elem.punktacja_zrodla_impact_factor }}
                    </td>
                    <td>{{ elem.ostatnio_zmieniony }}</td>
                    <td>
                        {% if filter_query_string %}
                            <a href="?{{ filter_query_string }}&sort={{ current_sort }}&_ignore={{ elem.pk }}"
                               class="button tiny secondary expanded"
                               data-confirm="Czy jesteś pewny, że chcesz zignorować ten rekord? Tej operacji nie można cofnąć.">
                                zignoruj</a>
                            <a href="?{{ filter_query_string }}&sort={{ current_sort }}&_set={{ elem.pk }}"
                               class="button tiny success expanded"
                               data-confirm="Czy jesteś pewny, że chcesz ustawić {{ field_label }} wg źródła? Tej operacji nie można cofnąć.">
                                ustaw wg źródła</a>
                        {% else %}
                            <a href="?sort={{ current_sort }}&_ignore={{ elem.pk }}"
                               class="button tiny secondary expanded"
                               data-confirm="Czy jesteś pewny, że chcesz zignorować ten rekord? Tej operacji nie można cofnąć.">
                                zignoruj</a>
                            <a href="?sort={{ current_sort }}&_set={{ elem.pk }}"
                               class="button tiny success expanded"
                               data-confirm="Czy jesteś pewny, że chcesz ustawić {{ field_label }} wg źródła? Tej operacji nie można cofnąć.">
                                ustaw wg źródła</a>
                        {% endif %}
                    </td>
                </tr>
            {% empty %}
                <tr>
                    <td colspan="7" class="text-center">
                        Brak rekordów z rozbieżnymi wartościami {{ field_label }} dla wybranych kryteriów.
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>

    {% include "pagination/pagination_with_anchor.html" %}

{% endblock %}
