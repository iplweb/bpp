{% extends "base.html" %}
{% load humanize %}
{% load temperature_filters %}
{% load l10n %}

{% block title %}Statystyki metryk ewaluacyjnych{% endblock %}

{% block breadcrumbs %}
    {{ block.super }}
    <li><a href="/">Strona główna</a></li>
    <li><a href="{% url 'ewaluacja_metryki:lista' %}">Metryki ewaluacyjne</a></li>
    <li class="current">Statystyki</li>
{% endblock %}

{% block content %}
<div class="row">
    <div class="columns">

        <h1>
            <span class="fi-graph-bar"></span> Statystyki metryk ewaluacyjnych
        </h1>

        <!-- Disclaimer komunikat -->
        {% include "ewaluacja_metryki/disclaimer.html" %}

        <!-- Navigation menu -->
        <div class="callout stats-navigation">
            <div class="button-group expanded">
                <a href="#statystyki-globalne" class="button hollow secondary">
                    <span class="fi-database"></span> Statystyki globalne
                </a>
                <a href="#top-autorzy" class="button hollow secondary">
                    <span class="fi-trophy"></span> Top PKDaut/slot
                </a>
                <a href="#top-sloty" class="button hollow secondary">
                    <span class="fi-trophy"></span> Top sloty
                </a>
                <a href="#bottom-autorzy" class="button hollow secondary">
                    <span class="fi-arrow-down"></span> Najniższe PKDaut/slot
                </a>
                <a href="#bottom-sloty" class="button hollow secondary">
                    <span class="fi-arrow-down"></span> Najniższe sloty
                </a>
                <a href="#autorzy-zerowi" class="button hollow secondary">
                    <span class="fi-minus-circle"></span> Autorzy zerowi
                </a>
                <a href="#jednostki" class="button hollow secondary">
                    <span class="fi-home"></span> Jednostki
                </a>
                <a href="#dyscypliny" class="button hollow secondary">
                    <span class="fi-book"></span> Dyscypliny
                </a>
            </div>
        </div>

        <!-- Statystyki globalne -->
        <div class="callout primary" id="statystyki-globalne">
            <div class="float-right">
                <a href="{% url 'ewaluacja_metryki:export_xlsx' 'globalne' %}" class="button tiny success">
                    <span class="fi-page-export"></span> Export XLSX
                </a>
            </div>
            <h3><span class="fi-database"></span> Statystyki globalne</h3>
            <div class="row">
                <div class="medium-2 columns text-center">
                    <h5>Liczba wierszy</h5>
                    <p class="stat">{{ statystyki_globalne.liczba_wierszy|default:"0" }}</p>
                </div>
                <div class="medium-2 columns text-center">
                    <h5>Liczba autorów</h5>
                    <p class="stat">{{ statystyki_globalne.liczba_autorow|default:"0" }}</p>
                </div>
                <div class="medium-2 columns text-center">
                    <h5>Średnie wykorzystanie</h5>
                    <p class="stat">{{ statystyki_globalne.srednia_wykorzystania|floatformat:1|default:"0" }}%</p>
                </div>
                <div class="medium-2 columns text-center">
                    <h5>Średnia PKDaut/slot</h5>
                    <p class="stat">{{ statystyki_globalne.srednia_pkd_slot|floatformat:2|default:"0" }}</p>
                </div>
                <div class="medium-2 columns text-center">
                    <h5>Suma punktów</h5>
                    <p class="stat">{{ statystyki_globalne.suma_punktow|floatformat:0|default:"0" }}</p>
                </div>
                <div class="medium-2 columns text-center">
                    <h5>Suma slotów</h5>
                    <p class="stat">{{ statystyki_globalne.suma_slotow|floatformat:0|default:"0" }}</p>
                </div>
            </div>
        </div>

        <!-- Navigation menu before Top autorzy -->
        <div class="callout stats-navigation">
            <div class="button-group expanded small">
                <a href="#statystyki-globalne" class="button hollow secondary">
                    <span class="fi-database"></span> Statystyki globalne
                </a>
                <a href="#top-autorzy" class="button hollow secondary">
                    <span class="fi-trophy"></span> Top PKDaut/slot
                </a>
                <a href="#top-sloty" class="button hollow secondary">
                    <span class="fi-trophy"></span> Top sloty
                </a>
                <a href="#bottom-autorzy" class="button hollow secondary">
                    <span class="fi-arrow-down"></span> Najniższe PKDaut/slot
                </a>
                <a href="#bottom-sloty" class="button hollow secondary">
                    <span class="fi-arrow-down"></span> Najniższe sloty
                </a>
                <a href="#autorzy-zerowi" class="button hollow secondary">
                    <span class="fi-minus-circle"></span> Autorzy zerowi
                </a>
                <a href="#jednostki" class="button hollow secondary">
                    <span class="fi-home"></span> Jednostki
                </a>
                <a href="#dyscypliny" class="button hollow secondary">
                    <span class="fi-book"></span> Dyscypliny
                </a>
            </div>
        </div>

        <!-- Top 20 autorów - wide list -->
        <div class="row">
            <div class="medium-12 columns">
                <div class="callout success" id="top-autorzy">
                    <div class="float-right">
                        <a href="{% url 'ewaluacja_metryki:export_xlsx' 'top-autorzy' %}" class="button tiny success">
                            <span class="fi-page-export"></span> Export XLSX
                        </a>
                    </div>
                    <h4><span class="fi-trophy"></span> Top 20 autorów PKDaut/slot</h4>
                    <table class="hover">
                        <thead>
                            <tr>
                                <th width="50">Lp.</th>
                                <th>Autor</th>
                                <th>Rodzaj autora</th>
                                <th>Jednostka</th>
                                <th class="text-center">Średnia PKDaut/slot</th>
                                <th class="text-center">Wykorzystanie slotów</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for metryka in top_autorzy %}
                            <tr>
                                <td>{{ forloop.counter }}</td>
                                <td>
                                    <a href="{% url 'bpp:browse_autor' metryka.autor.pk %}" target="_blank" title="Szczegóły autora w BPP">
                                        {{ metryka.autor }}
                                    </a>
                                    <a href="{% url 'ewaluacja_metryki:szczegoly' autor_slug=metryka.autor.slug dyscyplina_kod=metryka.dyscyplina_naukowa.kod %}" title="Szczegóły metryki">
                                        <span class="fi-graph-bar"></span>
                                    </a>
                                </td>
                                <td>
                                    <small class="text-muted">
                                        {% if metryka.rodzaj_autora == " " %}
                                            Brak danych
                                        {% elif metryka.rodzaj_autora %}
                                            {{ metryka.rodzaj_autora }}
                                        {% else %}
                                            -
                                        {% endif %}
                                    </small>
                                </td>
                                <td>
                                    <small class="text-muted">
                                        {% if metryka.jednostka %}
                                            {{ metryka.jednostka.skrot|default:metryka.jednostka.nazwa }}
                                        {% else %}
                                            -
                                        {% endif %}
                                    </small>
                                </td>
                                <td class="text-center">
                                    {% temperature_display metryka.srednia_za_slot_nazbierana %}
                                </td>
                                <td>
                                    <div class="slot-progress-container">
                                        <div class="circular-progress-wrapper">
                                            <div class="circle-progress-{{ metryka.pk }}" data-value="{{ metryka.procent_wykorzystania_slotow|unlocalize }}" data-size="70" data-thickness="6"></div>
                                            <strong class="progress-percentage">0%</strong>
                                            <small class="progress-label">{{ metryka.slot_nazbierany|floatformat:2 }} / {{ metryka.slot_maksymalny|floatformat:2 }}</small>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Top 20 autorów - sloty wypełnione -->
        <div class="row">
            <div class="medium-12 columns">
                <div class="callout primary" id="top-sloty" style="background-color: #2ca8ff; border-color: #0e90db;">
                    <div class="float-right">
                        <a href="{% url 'ewaluacja_metryki:export_xlsx' 'top-sloty' %}" class="button tiny success">
                            <span class="fi-page-export"></span> Export XLSX
                        </a>
                    </div>
                    <h4><span class="fi-trophy"></span> Top 20 autorów sloty wypełnione</h4>
                    <table class="hover">
                        <thead>
                            <tr>
                                <th width="50">Lp.</th>
                                <th>Autor</th>
                                <th>Rodzaj autora</th>
                                <th>Jednostka</th>
                                <th class="text-center">Średnia PKDaut/slot</th>
                                <th class="text-center">Wykorzystanie slotów</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for metryka in top_autorzy_sloty %}
                            <tr>
                                <td>{{ forloop.counter }}</td>
                                <td>
                                    <a href="{% url 'bpp:browse_autor' metryka.autor.pk %}" target="_blank" title="Szczegóły autora w BPP">
                                        {{ metryka.autor }}
                                    </a>
                                    <a href="{% url 'ewaluacja_metryki:szczegoly' autor_slug=metryka.autor.slug dyscyplina_kod=metryka.dyscyplina_naukowa.kod %}" title="Szczegóły metryki">
                                        <span class="fi-graph-bar"></span>
                                    </a>
                                </td>
                                <td>
                                    <small class="text-muted">
                                        {% if metryka.rodzaj_autora == " " %}
                                            Brak danych
                                        {% elif metryka.rodzaj_autora %}
                                            {{ metryka.rodzaj_autora }}
                                        {% else %}
                                            -
                                        {% endif %}
                                    </small>
                                </td>
                                <td>
                                    <small class="text-muted">
                                        {% if metryka.jednostka %}
                                            {{ metryka.jednostka.skrot|default:metryka.jednostka.nazwa }}
                                        {% else %}
                                            -
                                        {% endif %}
                                    </small>
                                </td>
                                <td class="text-center">
                                    {% temperature_display metryka.srednia_za_slot_nazbierana %}
                                </td>
                                <td>
                                    <div class="slot-progress-container">
                                        <div class="circular-progress-wrapper">
                                            <div class="circle-progress-{{ metryka.pk }}" data-value="{{ metryka.procent_wykorzystania_slotow|unlocalize }}" data-size="70" data-thickness="6"></div>
                                            <strong class="progress-percentage">0%</strong>
                                            <small class="progress-label">{{ metryka.slot_nazbierany|floatformat:2 }} / {{ metryka.slot_maksymalny|floatformat:2 }}</small>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Rozkład wykorzystania slotów -->
        <div class="row">
            <div class="medium-6 columns">
                <div class="callout">
                    <div class="float-right">
                        <a href="{% url 'ewaluacja_metryki:export_xlsx' 'wykorzystanie' %}" class="button tiny success">
                            <span class="fi-page-export"></span> Export XLSX
                        </a>
                    </div>
                    <h4><span class="fi-graph-pie"></span> Rozkład wykorzystania slotów</h4>
                    <table class="hover">
                        <thead>
                            <tr>
                                <th>Przedział</th>
                                <th class="text-right">Liczba wierszy</th>
                                <th>Wykres</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for range, count in wykorzystanie_ranges.items %}
                            <tr>
                                <td>{{ range }}</td>
                                <td class="text-right">{{ count }}</td>
                                <td>
                                    <div class="progress" style="margin: 0;">
                                        <div class="progress-meter"
                                             style="width: {% widthratio count statystyki_globalne.liczba_wierszy 100 %}%">
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Navigation menu before Najniższe autorzy -->
        <div class="callout stats-navigation">
            <div class="button-group expanded small">
                <a href="#statystyki-globalne" class="button hollow secondary">
                    <span class="fi-database"></span> Statystyki globalne
                </a>
                <a href="#top-autorzy" class="button hollow secondary">
                    <span class="fi-trophy"></span> Top PKDaut/slot
                </a>
                <a href="#top-sloty" class="button hollow secondary">
                    <span class="fi-trophy"></span> Top sloty
                </a>
                <a href="#bottom-autorzy" class="button hollow secondary">
                    <span class="fi-arrow-down"></span> Najniższe PKDaut/slot
                </a>
                <a href="#bottom-sloty" class="button hollow secondary">
                    <span class="fi-arrow-down"></span> Najniższe sloty
                </a>
                <a href="#autorzy-zerowi" class="button hollow secondary">
                    <span class="fi-minus-circle"></span> Autorzy zerowi
                </a>
                <a href="#jednostki" class="button hollow secondary">
                    <span class="fi-home"></span> Jednostki
                </a>
                <a href="#dyscypliny" class="button hollow secondary">
                    <span class="fi-book"></span> Dyscypliny
                </a>
            </div>
        </div>

        <!-- Najniższe 20 autorów wg PKDaut/slot (nie-zerowych) -->
        <div class="row">
            <div class="medium-12 columns">
                <div class="callout warning" id="bottom-autorzy">
                    <div class="float-right">
                        <a href="{% url 'ewaluacja_metryki:export_xlsx' 'bottom-pkd' %}" class="button tiny success">
                            <span class="fi-page-export"></span> Export XLSX
                        </a>
                    </div>
                    <h4><span class="fi-arrow-down"></span> Najniższe 20 autorów wg PKDaut/slot (nie-zerowych)</h4>
                    <table class="hover">
                        <thead>
                            <tr>
                                <th width="50">Lp.</th>
                                <th>Autor</th>
                                <th>Rodzaj autora</th>
                                <th>Jednostka</th>
                                <th class="text-center">Średnia PKDaut/slot</th>
                                <th class="text-center">Wykorzystanie slotów</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for metryka in bottom_autorzy_pkd %}
                            <tr>
                                <td>{{ forloop.counter }}</td>
                                <td>
                                    <a href="{% url 'bpp:browse_autor' metryka.autor.pk %}" target="_blank" title="Szczegóły autora w BPP">
                                        {{ metryka.autor }}
                                    </a>
                                    <a href="{% url 'ewaluacja_metryki:szczegoly' autor_slug=metryka.autor.slug dyscyplina_kod=metryka.dyscyplina_naukowa.kod %}" title="Szczegóły metryki">
                                        <span class="fi-graph-bar"></span>
                                    </a>
                                </td>
                                <td>
                                    <small class="text-muted">
                                        {% if metryka.rodzaj_autora == " " %}
                                            Brak danych
                                        {% elif metryka.rodzaj_autora %}
                                            {{ metryka.rodzaj_autora }}
                                        {% else %}
                                            -
                                        {% endif %}
                                    </small>
                                </td>
                                <td>
                                    <small class="text-muted">
                                        {% if metryka.jednostka %}
                                            {{ metryka.jednostka.skrot|default:metryka.jednostka.nazwa }}
                                        {% else %}
                                            -
                                        {% endif %}
                                    </small>
                                </td>
                                <td class="text-center">
                                    {% temperature_display metryka.srednia_za_slot_nazbierana %}
                                </td>
                                <td>
                                    <div class="slot-progress-container">
                                        <div class="circular-progress-wrapper">
                                            <div class="circle-progress-{{ metryka.pk }}" data-value="{{ metryka.procent_wykorzystania_slotow|unlocalize }}" data-size="70" data-thickness="6"></div>
                                            <strong class="progress-percentage">0%</strong>
                                            <small class="progress-label">{{ metryka.slot_nazbierany|floatformat:2 }} / {{ metryka.slot_maksymalny|floatformat:2 }}</small>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Najniższe 20 autorów wg slotów wypełnionych (nie-zerowych) -->
        <div class="row">
            <div class="medium-12 columns">
                <div class="callout alert" id="bottom-sloty">
                    <div class="float-right">
                        <a href="{% url 'ewaluacja_metryki:export_xlsx' 'bottom-sloty' %}" class="button tiny success">
                            <span class="fi-page-export"></span> Export XLSX
                        </a>
                    </div>
                    <h4><span class="fi-arrow-down"></span> Najniższe 20 autorów wg slotów wypełnionych (nie-zerowych)</h4>
                    <table class="hover">
                        <thead>
                            <tr>
                                <th width="50">Lp.</th>
                                <th>Autor</th>
                                <th>Rodzaj autora</th>
                                <th>Jednostka</th>
                                <th class="text-center">Średnia PKDaut/slot</th>
                                <th class="text-center">Wykorzystanie slotów</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for metryka in bottom_autorzy_sloty %}
                            <tr>
                                <td>{{ forloop.counter }}</td>
                                <td>
                                    <a href="{% url 'bpp:browse_autor' metryka.autor.pk %}" target="_blank" title="Szczegóły autora w BPP">
                                        {{ metryka.autor }}
                                    </a>
                                    <a href="{% url 'ewaluacja_metryki:szczegoly' autor_slug=metryka.autor.slug dyscyplina_kod=metryka.dyscyplina_naukowa.kod %}" title="Szczegóły metryki">
                                        <span class="fi-graph-bar"></span>
                                    </a>
                                </td>
                                <td>
                                    <small class="text-muted">
                                        {% if metryka.rodzaj_autora == " " %}
                                            Brak danych
                                        {% elif metryka.rodzaj_autora %}
                                            {{ metryka.rodzaj_autora }}
                                        {% else %}
                                            -
                                        {% endif %}
                                    </small>
                                </td>
                                <td>
                                    <small class="text-muted">
                                        {% if metryka.jednostka %}
                                            {{ metryka.jednostka.skrot|default:metryka.jednostka.nazwa }}
                                        {% else %}
                                            -
                                        {% endif %}
                                    </small>
                                </td>
                                <td class="text-center">
                                    {% temperature_display metryka.srednia_za_slot_nazbierana %}
                                </td>
                                <td>
                                    <div class="slot-progress-container">
                                        <div class="circular-progress-wrapper">
                                            <div class="circle-progress-{{ metryka.pk }}" data-value="{{ metryka.procent_wykorzystania_slotow|unlocalize }}" data-size="70" data-thickness="6"></div>
                                            <strong class="progress-percentage">0%</strong>
                                            <small class="progress-label">{{ metryka.slot_nazbierany|floatformat:2 }} / {{ metryka.slot_maksymalny|floatformat:2 }}</small>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Navigation menu before Autorzy zerowi -->
        <div class="callout stats-navigation">
            <div class="button-group expanded small">
                <a href="#statystyki-globalne" class="button hollow secondary">
                    <span class="fi-database"></span> Statystyki globalne
                </a>
                <a href="#top-autorzy" class="button hollow secondary">
                    <span class="fi-trophy"></span> Top PKDaut/slot
                </a>
                <a href="#top-sloty" class="button hollow secondary">
                    <span class="fi-trophy"></span> Top sloty
                </a>
                <a href="#bottom-autorzy" class="button hollow secondary">
                    <span class="fi-arrow-down"></span> Najniższe PKDaut/slot
                </a>
                <a href="#bottom-sloty" class="button hollow secondary">
                    <span class="fi-arrow-down"></span> Najniższe sloty
                </a>
                <a href="#autorzy-zerowi" class="button hollow secondary">
                    <span class="fi-minus-circle"></span> Autorzy zerowi
                </a>
                <a href="#jednostki" class="button hollow secondary">
                    <span class="fi-home"></span> Jednostki
                </a>
                <a href="#dyscypliny" class="button hollow secondary">
                    <span class="fi-book"></span> Dyscypliny
                </a>
            </div>
        </div>

        <!-- Lista autorów zerowych -->
        <div class="row">
            <div class="medium-12 columns">
                <div class="callout secondary" id="autorzy-zerowi">
                    <div class="float-right">
                        <a href="{% url 'ewaluacja_metryki:export_xlsx' 'zerowi' %}" class="button tiny success">
                            <span class="fi-page-export"></span> Export XLSX
                        </a>
                    </div>
                    <h4><span class="fi-minus-circle"></span> Lista autorów zerowych</h4>
                    <p class="text-muted">Liczba autorów z wynikiem PKDaut/slot = 0: <strong>{{ autorzy_zerowi|length }}</strong></p>
                    <table class="hover">
                        <thead>
                            <tr>
                                <th>Lp.</th>
                                <th>Autor</th>
                                <th>Lata</th>
                                <th>Dyscyplina</th>
                                <th>Jednostka</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for metryka in autorzy_zerowi %}
                            <tr>
                                <td>{{ forloop.counter }}</td>
                                <td>
                                    <a href="{% url 'bpp:browse_autor' metryka.autor.pk %}" target="_blank" title="Szczegóły autora w BPP">
                                        {{ metryka.autor }}
                                    </a>
                                    <a href="{% url 'ewaluacja_metryki:szczegoly' autor_slug=metryka.autor.slug dyscyplina_kod=metryka.dyscyplina_naukowa.kod %}" title="Szczegóły metryki">
                                        <span class="fi-graph-bar"></span>
                                    </a>
                                </td>
                                <td>
                                    {% for rok in metryka.lata_zerowe %}
                                        <span class="label secondary" style="margin-right: 2px;">{{ rok }}</span>
                                    {% empty %}
                                        <span class="label secondary">
                                            {{ metryka.rok_min }}-{{ metryka.rok_max }}
                                        </span>
                                    {% endfor %}
                                </td>
                                <td>
                                    <small class="text-muted">
                                        {% if metryka.dyscyplina_naukowa %}
                                            {{ metryka.dyscyplina_naukowa.nazwa }}
                                        {% else %}
                                            -
                                        {% endif %}
                                    </small>
                                </td>
                                <td>
                                    <small class="text-muted">
                                        {% if metryka.jednostka %}
                                            {{ metryka.jednostka.skrot|default:metryka.jednostka.nazwa }}
                                        {% else %}
                                            -
                                        {% endif %}
                                    </small>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Navigation menu before Jednostki -->
        <div class="callout stats-navigation">
            <div class="button-group expanded small">
                <a href="#statystyki-globalne" class="button hollow secondary">
                    <span class="fi-database"></span> Statystyki globalne
                </a>
                <a href="#top-autorzy" class="button hollow secondary">
                    <span class="fi-trophy"></span> Top PKDaut/slot
                </a>
                <a href="#top-sloty" class="button hollow secondary">
                    <span class="fi-trophy"></span> Top sloty
                </a>
                <a href="#bottom-autorzy" class="button hollow secondary">
                    <span class="fi-arrow-down"></span> Najniższe PKDaut/slot
                </a>
                <a href="#bottom-sloty" class="button hollow secondary">
                    <span class="fi-arrow-down"></span> Najniższe sloty
                </a>
                <a href="#autorzy-zerowi" class="button hollow secondary">
                    <span class="fi-minus-circle"></span> Autorzy zerowi
                </a>
                <a href="#jednostki" class="button hollow secondary">
                    <span class="fi-home"></span> Jednostki
                </a>
                <a href="#dyscypliny" class="button hollow secondary">
                    <span class="fi-book"></span> Dyscypliny
                </a>
            </div>
        </div>

        <!-- Statystyki wg jednostek -->
        <div class="callout" id="jednostki">
            <div class="float-right">
                <a href="{% url 'ewaluacja_metryki:export_xlsx' 'jednostki' %}" class="button tiny success">
                    <span class="fi-page-export"></span> Export XLSX
                </a>
            </div>
            <h4><span class="fi-home"></span> Top 10 jednostek wg średniej PKDaut/slot</h4>
            <table class="hover">
                <thead>
                    <tr>
                        <th>Jednostka</th>
                        <th class="text-center">Liczba autorów</th>
                        <th class="text-center">Śr. wykorzystanie</th>
                        <th class="text-center">Śr. PKDaut/slot</th>
                        <th class="text-center">Suma punktów</th>
                    </tr>
                </thead>
                <tbody>
                    {% for stat in jednostki_stats %}
                    <tr>
                        <td>
                            {{ stat.jednostka__nazwa }}
                            {% if stat.jednostka__skrot %}
                                ({{ stat.jednostka__skrot }})
                            {% endif %}
                        </td>
                        <td class="text-center">{{ stat.liczba_autorow }}</td>
                        <td class="text-center">{{ stat.srednia_wykorzystania|floatformat:1 }}%</td>
                        <td class="text-center">
                            <span class="label {% if stat.srednia_pkd_slot >= 40 %}success{% elif stat.srednia_pkd_slot >= 25 %}warning{% else %}secondary{% endif %}">
                                {{ stat.srednia_pkd_slot|floatformat:2 }}
                            </span>
                        </td>
                        <td class="text-center">{{ stat.suma_punktow|floatformat:0 }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Navigation menu before Dyscypliny -->
        <div class="callout stats-navigation">
            <div class="button-group expanded small">
                <a href="#statystyki-globalne" class="button hollow secondary">
                    <span class="fi-database"></span> Statystyki globalne
                </a>
                <a href="#top-autorzy" class="button hollow secondary">
                    <span class="fi-trophy"></span> Top PKDaut/slot
                </a>
                <a href="#top-sloty" class="button hollow secondary">
                    <span class="fi-trophy"></span> Top sloty
                </a>
                <a href="#bottom-autorzy" class="button hollow secondary">
                    <span class="fi-arrow-down"></span> Najniższe PKDaut/slot
                </a>
                <a href="#bottom-sloty" class="button hollow secondary">
                    <span class="fi-arrow-down"></span> Najniższe sloty
                </a>
                <a href="#autorzy-zerowi" class="button hollow secondary">
                    <span class="fi-minus-circle"></span> Autorzy zerowi
                </a>
                <a href="#jednostki" class="button hollow secondary">
                    <span class="fi-home"></span> Jednostki
                </a>
                <a href="#dyscypliny" class="button hollow secondary">
                    <span class="fi-book"></span> Dyscypliny
                </a>
            </div>
        </div>

        <!-- Statystyki wg dyscyplin -->
        <div class="callout secondary" id="dyscypliny">
            <div class="float-right">
                <a href="{% url 'ewaluacja_metryki:export_xlsx' 'dyscypliny' %}" class="button tiny success">
                    <span class="fi-page-export"></span> Export XLSX
                </a>
            </div>
            <h4><span class="fi-book"></span> Statystyki wg dyscyplin</h4>
            <table class="hover">
                <thead>
                    <tr>
                        <th>Dyscyplina</th>
                        <th class="text-center">Kod</th>
                        <th class="text-center">Liczba autorów</th>
                        <th class="text-center">Śr. wykorzystanie</th>
                        <th class="text-center">Śr. PKDaut/slot</th>
                        <th class="text-center">Suma punktów</th>
                    </tr>
                </thead>
                <tbody>
                    {% for stat in dyscypliny_stats %}
                    <tr>
                        <td>{{ stat.dyscyplina_naukowa__nazwa }}</td>
                        <td class="text-center">{{ stat.dyscyplina_naukowa__kod|default:"-" }}</td>
                        <td class="text-center">{{ stat.liczba_autorow }}</td>
                        <td class="text-center">{{ stat.srednia_wykorzystania|floatformat:1 }}%</td>
                        <td class="text-center">
                            <span class="label {% if stat.srednia_pkd_slot >= 40 %}success{% elif stat.srednia_pkd_slot >= 25 %}warning{% else %}secondary{% endif %}">
                                {{ stat.srednia_pkd_slot|floatformat:2 }}
                            </span>
                        </td>
                        <td class="text-center">{{ stat.suma_punktow|floatformat:0 }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <div class="button-group">
            <a href="{% url 'ewaluacja_metryki:lista' %}" class="button secondary">
                <span class="fi-arrow-left"></span> Powrót do listy
            </a>
        </div>
    </div>
</div>

<style>
    /* Fix for anchor scrolling under fixed header */
    html {
        scroll-padding-top: 120px; /* Adjust based on your header height */
    }

    .stat {
        font-size: 2rem;
        font-weight: bold;
        color: #1779ba;
    }
    .text-muted {
        color: #8a8a8a;
    }

    /* Circular Progress Bar Styles */
    .slot-progress-container {
        display: flex;
        justify-content: center;
        align-items: center;
        text-align: center;
    }

    .circular-progress-wrapper {
        position: relative;
        display: inline-block;
    }

    .circular-progress-wrapper canvas {
        display: block;
    }

    .circular-progress-wrapper .progress-percentage {
        position: absolute;
        top: 35px;  /* Centered in 70px circle */
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 14px;
        font-weight: 600;
        color: #333;
        z-index: 1;
    }

    .circular-progress-wrapper .progress-label {
        display: block;
        margin-top: 5px;
        color: #666;
        font-size: 0.85rem;
        white-space: nowrap;
    }

    /* PKDaut/slot Metric Display */
    .pkd-metric-container {
        display: inline-block;
        min-width: 200px;
        padding: 10px;
        background: #f8f9fa;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .pkd-value-label {
        text-align: center;
        margin-bottom: 8px;
    }

    .pkd-value-label strong {
        font-size: 1.25rem;
        color: #2c3e50;
        display: block;
    }

    .pkd-value-label small {
        color: #7f8c8d;
        font-size: 0.75rem;
    }

    .pkd-progress-bar {
        margin: 10px 0;
    }

    .pkd-progress-track {
        height: 20px;
        background: #e0e0e0;
        border-radius: 10px;
        overflow: hidden;
        position: relative;
        box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
    }

    .pkd-progress-fill {
        height: 100%;
        border-radius: 10px;
        position: relative;
        transition: all 0.5s ease;
        box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .pkd-marker {
        position: absolute;
        right: -2px;
        top: 50%;
        transform: translateY(-50%);
        width: 4px;
        height: 140%;
        background: rgba(255, 255, 255, 0.8);
        border-radius: 2px;
        box-shadow: 0 0 4px rgba(0,0,0,0.3);
    }

    .pkd-scale-labels {
        display: flex;
        justify-content: space-between;
        margin-top: 4px;
        font-size: 0.7rem;
        color: #95a5a6;
    }

    .pkd-quality-label {
        text-align: center;
        font-size: 0.85rem;
        font-weight: 600;
        padding: 4px 8px;
        border-radius: 4px;
        margin-top: 8px;
        transition: all 0.3s ease;
    }

    /* Temperature gradient colors for PKD progress bars */
    .pkd-progress-fill.temp-0 {
        background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
    }
    .pkd-quality-label.temp-0 {
        background: #667eea;
        color: white;
    }

    .pkd-progress-fill.temp-20 {
        background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);
    }
    .pkd-quality-label.temp-20 {
        background: #4facfe;
        color: white;
    }

    .pkd-progress-fill.temp-40 {
        background: linear-gradient(90deg, #43e97b 0%, #38f9d7 100%);
    }
    .pkd-quality-label.temp-40 {
        background: #43e97b;
        color: white;
    }

    .pkd-progress-fill.temp-60 {
        background: linear-gradient(90deg, #30cfd0 0%, #330867 100%);
    }
    .pkd-quality-label.temp-60 {
        background: #30cfd0;
        color: white;
    }

    .pkd-progress-fill.temp-80 {
        background: linear-gradient(90deg, #a8edea 0%, #fed6e3 100%);
    }
    .pkd-quality-label.temp-80 {
        background: #a8edea;
        color: #333;
    }

    .pkd-progress-fill.temp-100 {
        background: linear-gradient(90deg, #ffecd2 0%, #fcb69f 100%);
    }
    .pkd-quality-label.temp-100 {
        background: #fcb69f;
        color: #333;
    }

    .pkd-progress-fill.temp-120 {
        background: linear-gradient(90deg, #ff9a56 0%, #ff6a88 100%);
    }
    .pkd-quality-label.temp-120 {
        background: #ff9a56;
        color: white;
    }

    .pkd-progress-fill.temp-140 {
        background: linear-gradient(90deg, #ff6a88 0%, #ff3838 100%);
    }
    .pkd-quality-label.temp-140 {
        background: #ff6a88;
        color: white;
    }

    .pkd-progress-fill.temp-160 {
        background: linear-gradient(90deg, #ff3838 0%, #ff0844 100%);
    }
    .pkd-quality-label.temp-160 {
        background: #ff3838;
        color: white;
    }

    .pkd-progress-fill.temp-180 {
        background: linear-gradient(90deg, #ff0844 0%, #ffb199 100%);
    }
    .pkd-quality-label.temp-180 {
        background: #ff0844;
        color: white;
    }

    .pkd-progress-fill.temp-200 {
        background: linear-gradient(90deg, #ff0844 0%, #ffd700 50%, #ffffff 100%);
        animation: pulse-light 2s infinite;
    }
    .pkd-quality-label.temp-200 {
        background: linear-gradient(90deg, #ff0844, #ffd700);
        color: white;
        animation: pulse-light 2s infinite;
    }

    @keyframes pulse-light {
        0% {
            box-shadow: 0 0 5px rgba(255, 215, 0, 0.5);
        }
        50% {
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
        }
        100% {
            box-shadow: 0 0 5px rgba(255, 215, 0, 0.5);
        }
    }

    /* Temperature gradient classes */
    .temperature-display {
        display: inline-block;
        padding: 6px 12px;
        border-radius: 20px;
        font-weight: bold;
        color: white;
        text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        transition: all 0.3s ease;
        position: relative;
        min-width: 80px;
    }

    .temperature-display:hover {
        transform: scale(1.05);
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }

    .temperature-icon {
        font-size: 0.9em;
        margin-left: 4px;
        opacity: 0.9;
    }

    /* Temperature gradient colors - from freezing cold to blazing hot */
    .temp-0 {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        /* Freezing purple */
    }

    .temp-20 {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        /* Very cold blue */
    }

    .temp-40 {
        background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
        /* Cold cyan */
    }

    .temp-60 {
        background: linear-gradient(135deg, #30cfd0 0%, #330867 100%);
        /* Cool teal */
    }

    .temp-80 {
        background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
        /* Moderate pastel */
        color: #333;
        text-shadow: 1px 1px 2px rgba(255,255,255,0.5);
    }

    .temp-100 {
        background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
        /* Moderate warm */
        color: #333;
        text-shadow: 1px 1px 2px rgba(255,255,255,0.5);
    }

    .temp-120 {
        background: linear-gradient(135deg, #ff9a56 0%, #ff6a88 100%);
        /* Warm */
    }

    .temp-140 {
        background: linear-gradient(135deg, #ff6a88 0%, #ff3838 100%);
        /* Warm-hot */
    }

    .temp-160 {
        background: linear-gradient(135deg, #ff3838 0%, #ff0844 100%);
        /* Hot red */
    }

    .temp-180 {
        background: linear-gradient(135deg, #ff0844 0%, #ffb199 100%);
        /* Very hot */
    }

    .temp-200 {
        background: linear-gradient(135deg, #ff0844 0%, #ffd700 50%, #ffffff 100%);
        /* Blazing hot - red to gold to white */
        animation: pulse 2s infinite;
    }

    @keyframes pulse {
        0% {
            box-shadow: 0 0 0 0 rgba(255, 8, 68, 0.7);
        }
        70% {
            box-shadow: 0 0 0 10px rgba(255, 8, 68, 0);
        }
        100% {
            box-shadow: 0 0 0 0 rgba(255, 8, 68, 0);
        }
    }

    /* Additional visual indicator */
    .temperature-display::after {
        content: '';
        position: absolute;
        top: -2px;
        right: -2px;
        bottom: -2px;
        left: -2px;
        border-radius: 20px;
        opacity: 0;
        transition: opacity 0.3s ease;
        z-index: -1;
    }

    .temp-200::after {
        background: linear-gradient(45deg, #ff0844, #ffd700, #ff0844);
        animation: rotate 3s linear infinite;
        opacity: 0.5;
    }

    @keyframes rotate {
        to {
            transform: rotate(360deg);
        }
    }

    /* Progress meter text styles */
    .progress-meter-text {
        font-size: 0.75rem;
        font-weight: bold;
    }
</style>



<script>
// Inicjalizacja Foundation
$(document).foundation();

// Inicjalizacja okrągłych pasków postępu
$(document).ready(function() {
    console.log('Initializing circular progress bars for statistics page...');

    // Funkcja pomocnicza do wyboru gradientu na podstawie procentu wykorzystania
    function getGradientForPercentage(percentage) {
        if (percentage >= 90) {
            return ["#4CAF50", "#8BC34A"];  // Zielony gradient dla wysokich wartości
        } else if (percentage >= 70) {
            return ["#FFC107", "#FF9800"];  // Żółty/pomarańczowy gradient dla średnich wartości
        } else if (percentage >= 50) {
            return ["#FF9800", "#FF5722"];  // Pomarańczowy gradient
        } else {
            return ["#f44336", "#e91e63"];  // Czerwony gradient dla niskich wartości
        }
    }

    // Inicjalizuj wszystkie paski postępu
    $('[class^="circle-progress-"]').each(function() {
        var $this = $(this);
        var percentage = parseFloat($this.data('value')) || 0;
        var gradient = getGradientForPercentage(percentage);

        $this.circleProgress({
            value: percentage / 100,
            size: 70,
            thickness: 6,
            animation: { duration: 1000, easing: "circleProgressEasing" },
            fill: {
                gradient: gradient
            }
        }).on('circle-animation-progress', function(event, progress, stepValue) {
            $(this).siblings('.progress-percentage').text(Math.round(stepValue * 100) + '%');
        });
    });

    console.log('Circular progress bars initialized.');
});
</script>
{% endblock %}
