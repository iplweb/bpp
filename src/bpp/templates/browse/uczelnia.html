{% extends "base.html" %}
{% load user_in_group deklinacja cache %}

{% block extratitle %}
    Uczelnia
{% endblock %}

{% block breadcrumbs-html %}
    <!-- Tips section in place of breadcrumbs for main page -->
        <div id="breadcrumbs-wrapper" class="grid-container-fluid hide-for-small-only" style="background-color: rgba(240, 240, 240, 0.85); border-bottom: 1px solid #d6d6d6; padding: 10px 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); position: sticky; top: 50px; z-index: 1; backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px);">
        <div class="grid-x">
            <div class="cell">
                <div id="rotating-tips" style="text-align: center; font-size: 14px; line-height: 1.4;">
                    <div class="tip-content" style="display: none; opacity: 0; transition: opacity 0.5s ease-in-out;">
                        üí° <strong>Porady BPP:</strong> <span id="tip-text">≈Åadowanie porad...</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const tips = [
            'U≈ºyj <a href="/multiseek/">wyszukiwarki zaawansowanej</a> aby znale≈∫ƒá publikacje wed≈Çug r√≥≈ºnych kryteri√≥w.',
            'W <a href="/admin/">panelu administracyjnym</a> mo≈ºesz zarzƒÖdzaƒá rekordami publikacji i autor√≥w.',
            'Skorzystaj z <a href="/bpp/ranking-autorow/">rankingu autor√≥w</a> aby zobaczyƒá najaktywniejszych badaczy.',
            'Funkcja <strong>eksportu do PBN</strong> pozwala na synchronizacjƒô danych z PolskƒÖ BibliografiƒÖ NaukowƒÖ.',
            'W module <strong>raport√≥w</strong> znajdziesz szczeg√≥≈Çowe zestawienia publikacji wed≈Çug jednostek i wydzia≈Ç√≥w.',
            'U≈ºyj filtr√≥w <strong>wed≈Çug roku</strong> aby ograniczyƒá wyniki wyszukiwania do okre≈õlonego okresu.',
            'System automatycznie <strong>przypisuje punktacjƒô</strong> publikacjom zgodnie z aktualnymi listami ministeralnymi.',
            'Funkcja <strong>duplikat√≥w</strong> pomaga w identyfikacji i usuwaniu powtarzajƒÖcych siƒô rekord√≥w.',
            'W <strong>profilach autor√≥w</strong> znajdziesz pe≈ÇnƒÖ listƒô ich publikacji i wsp√≥≈Çprac.',
            'System obs≈Çuguje import danych z <strong>zewnƒôtrznych baz</strong> jak CrossRef czy Web of Science.',
            'U≈ºyj opcji <strong>"Zg≈Ço≈õ publikacjƒô"</strong> aby dodaƒá nowe pozycje do bazy danych.',
            'Funkcja <strong>o≈õwiadcze≈Ñ autor√≥w</strong> pozwala na przypisanie publikacji do w≈Ça≈õciwych dyscyplin naukowych.',
            'W module <strong>statystyk</strong> znajdziesz wykresy pokazujƒÖce trendy publikacyjne uczelni.',
            'System automatycznie <strong>aktualizuje cytowania</strong> z baz Web of Science i Scopus.',
            'Skorzystaj z <strong>eksportu do BibTeX</strong> aby zaimportowaƒá publikacje do program√≥w bibliograficznych.'
        ];

        const tipTextElement = document.getElementById('tip-text');
        const tipContentElement = document.querySelector('.tip-content');
        let usedTips = [];

        function getRandomTip() {
            // If all tips have been used, reset the array
            if (usedTips.length >= tips.length) {
                usedTips = [];
            }

            let randomIndex;
            do {
                randomIndex = Math.floor(Math.random() * tips.length);
            } while (usedTips.includes(randomIndex));

            usedTips.push(randomIndex);
            return tips[randomIndex];
        }

        function showNextTip() {
            // Fade out current tip
            tipContentElement.style.opacity = '0';

            setTimeout(function() {
                // Change text while invisible
                tipTextElement.innerHTML = getRandomTip();
                tipContentElement.style.display = 'block';

                // Fade in new tip
                setTimeout(function() {
                    tipContentElement.style.opacity = '1';
                }, 50);
            }, 500); // Wait for fade out to complete
        }

        // Show first tip immediately
        tipTextElement.innerHTML = getRandomTip();
        tipContentElement.style.display = 'block';
        setTimeout(function() {
            tipContentElement.style.opacity = '1';
        }, 100);

        // Rotate tips every 15 seconds
        setInterval(showNextTip, 15000);
    });
    </script>
{% endblock %}

{% block content %}
    <div class="grid-x grid-padding-x align-middle align-center">
        {% if uczelnia.logo_www %}
            <div class="large-4 medium-2 cell">
                <img src="/media/{{ uczelnia.logo_www }}"
                     alt="Logo {{ uczelnia.nazwa_dopelniacz }}"
                />
            </div>
        {% endif %}
        <div class="large-6 medium-10 cell">
            <h2>
                Bibliografia Publikacji Pracownik√≥w<br/>
                {{ uczelnia.nazwa_dopelniacz }}
            </h2>
        </div>
        <div class="large-12 cell">
            <hr size="1">
        </div>
        <a href="/zglos_publikacje/nowe_zgloszenie/">Masz nowƒÖ publikacjƒô? Dodaj jƒÖ do bazy!</a>
        <div class="large-12 cell">
            <hr size="1">
            <br/>
        </div>
    </div>

    <div class="grid-x grid-margin-x">
        {% if article %}
            <div class="small-12 large-6 cell">
                <h2>{{ article.title }}</h2>
                {% include "browse/go_to_admin_change.html" with group="web" url="admin:miniblog_article_change" pk=article.pk text="otw√≥rz do edycji" %}
                <p>opublikowano {{ article.published_on }}</p>
                <p>{{ article.article_body.content|safe }}</p>
                <a href="..">wstecz</a>
            </div>
        {% else %}
            {% if miniblog.exists or request.user.is_superuser or request.user|has_group:"web" %}
                <div class="small-12 large-6 cell">
                    <h2>Aktualno≈õci</h2>
                    {% for article in miniblog %}
                        <h3><strong>{{ article.title }}</strong></h3>
                        <p>
                            opublikowano {{ article.published_on }}</p>
                        <p>{{ article.article_body.excerpt|safe }}</p>
                        {% if article.article_body.has_more %}
                            <p>
                                <a href="{% url "bpp:browse_artykul" uczelnia.slug article.slug %}">
                                    wiƒôcej
                                </a>
                            </p>
                        {% endif %}
                    {% endfor %}
                    {% include "browse/go_to_admin_list.html" with group="web" url="admin:miniblog_article_changelist" text="<i class='fi-wrench'></i> zarzƒÖdzaj aktualno≈õciami" %}
                    {% include "browse/go_to_admin_list.html" with group="web" url="admin:miniblog_article_add" text="<i class='fi-page-add'></i> dodaj artyku≈Ç" %}
                </div>

            {% endif %}
        {% endif %}
        {% if uczelnia.pokazuj_wydzialy_na_pierwszej_stronie %}
            <div class="small-12 large-6 cell">
                <h2>Wybierz {% rzeczownik_wydzia≈Ç %}</h2>
                <ul class="no-bullet" style="line-height: 250%;">
                    {% for wydzial in uczelnia.wydzialy %}
                        <li>
                            <a href="{% url "bpp:browse_wydzial" wydzial.slug %}">{{ wydzial }}</a>
                        </li>
                    {% endfor %}
                </ul>
                {% include "browse/go_to_admin_list.html" with group="struktura" url="admin:bpp_wydzial_changelist" text="<i class='fi-wrench'></i> zarzƒÖdzaj wydzia≈Çami" %}
                {% include "browse/go_to_admin_change.html" with url="admin:bpp_uczelnia_change" pk=uczelnia.pk group="struktura" text="ustawienia dla uczelni" %}
            </div>
            </div>
        {% endif %}
    {% if uczelnia.pokazuj_jednostki_na_pierwszej_stronie %}
        <div class="small-12 large-6 cell">{% load deklinacja %}
            <h2>Wybierz {% rzeczownik_jednostkƒô %}</h2>
            <ul class="no-bullet" style="line-height: 250%;">
                {% for jednostka in uczelnia.jednostki %}
                    <li>
                        <a href="{% url "bpp:browse_jednostka" jednostka.slug %}">{{ jednostka }}</a>
                    </li>
                {% endfor %}
            </ul>
            {% include "browse/go_to_admin_list.html" with group="struktura" url="admin:bpp_jednostka_changelist" text="<i class='fi-wrench'></i> zarzƒÖdzaj jednostkami" %}
            {% include "browse/go_to_admin_change.html" with url="admin:bpp_uczelnia_change" pk=uczelnia.pk group="struktura" text="ustawienia dla uczelni" %}
        </div>
        </div>
    {% endif %}

    {% if recently_updated or recent_abstracts %}
        <div class="grid-x grid-margin-x">
            {% if recently_updated %}
                {% cache 3600 recent_publications uczelnia.pk %}
                <div class="small-12 large-6 cell">
                    <h2>üìö Niedawno zaktualizowane rekordy:</h2>
                    <ul class="no-bullet" style="line-height: 180%;">
                        {% for rekord in recently_updated %}
                            <li style="margin-bottom: 12px; padding-bottom: 12px; border-bottom: 1px solid #e6e6e6;">
                                <a href="{{ rekord.get_absolute_url }}" style="font-size: 14px; line-height: 1.4; display: block;">
                                    {{ rekord.opis_bibliograficzny_cache|safe }}
                                </a>
                                <div style="font-size: 12px; color: #666; margin-top: 5px;">
                                    {{ rekord.ostatnio_zmieniony|date:"d.m.Y H:i" }}
                                    {% if rekord.rok %} ‚Ä¢ {{ rekord.rok }}{% endif %}
                                </div>
                            </li>
                        {% endfor %}
                    </ul>
                    <div style="text-align: center; margin-top: 15px;">
                        <a href="/multiseek/" class="button secondary expanded">Zobacz wszystkie publikacje</a>
                    </div>
                </div>
                {% endcache %}
            {% endif %}

            {% if recent_abstracts %}
                {% cache 3600 recent_abstracts uczelnia.pk %}
                <div class="small-12 large-6 cell">
                    <h2>üìÑ Najnowsze streszczenia:</h2>
                    <ul class="no-bullet" style="line-height: 180%;">
                        {% for rekord in recent_abstracts %}
                            <li style="margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid #e6e6e6;">
                                <a href="{{ rekord.rekord.get_absolute_url }}" style="font-size: 14px; line-height: 1.4; display: block; font-weight: bold; margin-bottom: 8px;">
                                    {{ rekord.rekord.opis_bibliograficzny_cache|safe }}
                                </a>
                                <div style="font-size: 13px; line-height: 1.4; color: #333; margin-bottom: 5px;">
                                    {{ rekord.streszczenie|safe|truncatewords:130 }}
                                </div>
                                <div style="font-size: 12px; color: #666;">
                                    {{ rekord.ostatnio_zmieniony|date:"d.m.Y H:i" }}
                                    {% if rekord.rok %} ‚Ä¢ {{ rekord.rok }}{% endif %}
                                </div>
                            </li>
                        {% endfor %}
                    </ul>
                </div>
                {% endcache %}
            {% endif %}
        </div>
    {% endif %}

{% endblock %}
