{% extends "base.html" %}
{% load user_in_group deklinacja cache media_utils static %}

{% block extratitle %}
    Uczelnia
{% endblock %}

{% block breadcrumbs-html %}
    <!-- Tips section in place of breadcrumbs for main page -->
        <div id="breadcrumbs-wrapper" class="grid-container-fluid hide-for-small-only breadcrumbs-tips-wrapper">
        <div class="grid-x">
            <div class="cell">
                <div id="rotating-tips">
                    <div class="tip-content">
                        <i class="fi-lightbulb"></i> <strong>Porady BPP:</strong> <span id="tip-text">Ładowanie porad...</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const tips = [
            'Użyj <a href="/multiseek/">wyszukiwarki zaawansowanej</a> aby znaleźć publikacje według różnych kryteriów.',
            'W <a href="/admin/">panelu administracyjnym</a> możesz zarządzać rekordami publikacji i autorów.',
            'Skorzystaj z <a href="/bpp/ranking-autorow/">rankingu autorów</a> aby zobaczyć najaktywniejszych badaczy.',
            'Funkcja <strong>eksportu do PBN</strong> pozwala na synchronizację danych z Polską Bibliografią Naukową.',
            'W module <strong>raportów</strong> znajdziesz szczegółowe zestawienia publikacji według jednostek i wydziałów.',
            'Użyj filtrów <strong>według roku</strong> aby ograniczyć wyniki wyszukiwania do określonego okresu.',
            'System automatycznie <strong>przypisuje punktację</strong> publikacjom zgodnie z aktualnymi listami ministeralnymi.',
            'Funkcja <strong>duplikatów</strong> pomaga w identyfikacji i usuwaniu powtarzających się rekordów.',
            'W <strong>profilach autorów</strong> znajdziesz pełną listę ich publikacji i współprac.',
            'System obsługuje import danych z <strong>zewnętrznych baz</strong> jak CrossRef czy Web of Science.',
            'Użyj opcji <strong>"Zgłoś publikację"</strong> aby dodać nowe pozycje do bazy danych.',
            'Funkcja <strong>oświadczeń autorów</strong> pozwala na przypisanie publikacji do właściwych dyscyplin naukowych.',
            'W module <strong>statystyk</strong> znajdziesz wykresy pokazujące trendy publikacyjne uczelni.',
            'System automatycznie <strong>aktualizuje cytowania</strong> z baz Web of Science i Scopus.',
            'Skorzystaj z <strong>eksportu do BibTeX</strong> aby zaimportować publikacje do programów bibliograficznych.'
        ];

        const tipTextElement = document.getElementById('tip-text');
        const tipContentElement = document.querySelector('.tip-content');
        let usedTips = [];

        function getRandomTip() {
            // If all tips have been used, reset the array
            if (usedTips.length >= tips.length) {
                usedTips = [];
            }

            let randomIndex;
            do {
                randomIndex = Math.floor(Math.random() * tips.length);
            } while (usedTips.includes(randomIndex));

            usedTips.push(randomIndex);
            return tips[randomIndex];
        }

        function showNextTip() {
            // Fade out current tip
            tipContentElement.style.opacity = '0';

            setTimeout(function() {
                // Change text while invisible
                tipTextElement.innerHTML = getRandomTip();
                tipContentElement.style.display = 'block';

                // Fade in new tip
                setTimeout(function() {
                    tipContentElement.style.opacity = '1';
                }, 50);
            }, 500); // Wait for fade out to complete
        }

        // Show first tip immediately
        tipTextElement.innerHTML = getRandomTip();
        tipContentElement.style.display = 'block';
        setTimeout(function() {
            tipContentElement.style.opacity = '1';
        }, 100);

        // Rotate tips every 15 seconds
        setInterval(showNextTip, 15000);
    });
    </script>
{% endblock %}

{% block content %}

{% include 'search_banner.html' %}

<script>

    // Check if banner was already dismissed
    document.addEventListener('DOMContentLoaded', function() {
        const banner = document.getElementById('search-shortcut-banner');
        const bannerDismissed = localStorage.getItem('searchBannerDismissed');
        const dismissedDate = localStorage.getItem('searchBannerDismissedDate');

        // Show banner if not dismissed or if dismissed more than 30 days ago
        if (!bannerDismissed || (dismissedDate && daysSince(dismissedDate) > 30)) {
            setTimeout(function() {
                banner.style.display = 'block';
            }, 500); // Small delay for better UX
        }
    });

    function daysSince(dateString) {
        const date = new Date(dateString);
        const now = new Date();
        const diffTime = Math.abs(now - date);
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        return diffDays;
    }

    function closeSearchBanner() {
        const banner = document.getElementById('search-shortcut-banner');
        banner.classList.add('closing');

        // Save dismissal state
        localStorage.setItem('searchBannerDismissed', 'true');
        localStorage.setItem('searchBannerDismissedDate', new Date().toISOString());

        // Remove from DOM after animation
        setTimeout(function() {
            banner.style.display = 'none';
            banner.remove();
        }, 300);
    }

    // Also close banner when user uses the shortcut
    document.addEventListener('keydown', function(e) {
        if (e.key === '/' && !$(e.target).is('input, textarea, select')) {
            const banner = document.getElementById('search-shortcut-banner');
            if (banner && banner.style.display !== 'none') {
                closeSearchBanner();
            }
        }
    });
</script>



    <div class="grid-x grid-padding-x align-middle align-center">
        {% if uczelnia.logo_www and uczelnia.logo_www|media_exists %}
            <div class="large-4 medium-2 cell">
                <img src="/media/{{ uczelnia.logo_www }}"
                     alt="Logo {{ uczelnia.nazwa_dopelniacz }}"
                />
            </div>
        {% else %}
            <div class="large-4 medium-2 cell">
                <img src="{% static 'images/bpp-icon.png' %}"
                     alt="Logo {{ uczelnia.nazwa_dopelniacz }}"
                     style="filter: grayscale(100%); opacity: 0.7;"
                />
            </div>
        {% endif %}
        <div class="large-6 medium-10 cell">
            <h2>
                Bibliografia Publikacji Pracowników<br/>
                {{ uczelnia.nazwa_dopelniacz }}
            </h2>
        </div>
        <div class="large-12 cell">
            <div class="shaded-hr-div"></div>
        </div>
        <div class="large-12 cell uczelnia-main-content">
            <a href="/zglos_publikacje/nowe_zgloszenie/" class=" main-page-button-primary">
                <i class="fi-page-add"></i> Masz nową publikację? Dodaj ją do bazy
            </a>
            {% if total_rekord_count > 25000 %}
                <form method="post" action="{% url 'bpp:browse_build_search' %}" style="display: inline;">
                    {% csrf_token %}
                    <input type="hidden" name="zakres_lat" value="[2022,{{ current_year }}]">
                    <input type="hidden" name="suggested-title" value="Cała baza to {{ total_rekord_count }} rekordów. Oglądasz wycinek - rekordy od 2022r"/>
                    <button type="submit" class="main-page-button-secondary" style="border: none; background: none; padding: 0;">
                        <span class="main-page-button-secondary" style="display: inline-block;">
                            <i class="fi-page-search"></i> Przeglądaj najnowsze prace
                        </span>
                    </button>
                </form>
            {% else %}
                <a href="{% url 'multiseek:index' %}" class="main-page-button-secondary">
                    <i class="fi-page-search"></i> Przeglądaj wszystkie prace
                </a>
            {% endif %}
            <a href="#" onclick="openGlobalSearch(event); return false;" class="main-page-button-search-field">
                <i class="fi-text-color"></i>
                <span class="search-placeholder">Wyszukaj tekstem</span>
                <span class="search-cursor"></span>
            </a>
        </div>
        <div class="large-12 cell">
            <div class="shaded-hr-div"></div>
        </div>
    </div>

    <!-- Browse panels -->
    <div class="grid-x grid-margin-x" style="margin-top: 40px;">
        <div class="small-12 cell">
            <h2 style="color: #2c3e50; margin-bottom: 20px; font-size: 1.5rem;">
                <i class="fi-compass"></i> Przeglądaj bazę publikacji
            </h2>
            <div class="grid-x grid-margin-x">
                <div class="small-12 medium-6 large-3 cell">
                    <a href="/bpp/autorzy/" class="browse-tile">
                        <div style="padding: 20px; background: #f8f9fa; border-radius: 8px; border: 1px solid #dee2e6; text-align: center; transition: all 0.3s ease; height: 100%;">
                            <i class="fi-torsos-all" style="font-size: 3rem; color: #007bff; display: block; margin-bottom: 10px;"></i>
                            <h4 style="color: #2c3e50; margin-bottom: 5px;">Autorzy</h4>
                            <p style="color: #6c757d; font-size: 0.9rem; margin: 0;">Przeglądaj według nazwiska autora</p>
                        </div>
                    </a>
                </div>
                <div class="small-12 medium-6 large-3 cell">
                    <a href="/bpp/zrodla/" class="browse-tile">
                        <div style="padding: 20px; background: #f8f9fa; border-radius: 8px; border: 1px solid #dee2e6; text-align: center; transition: all 0.3s ease; height: 100%;">
                            <i class="fi-book" style="font-size: 3rem; color: #28a745; display: block; margin-bottom: 10px;"></i>
                            <h4 style="color: #2c3e50; margin-bottom: 5px;">Źródła</h4>
                            <p style="color: #6c757d; font-size: 0.9rem; margin: 0;">Przeglądaj czasopisma i wydawnictwa</p>
                        </div>
                    </a>
                </div>
                <div class="small-12 medium-6 large-3 cell">
                    <a href="{% url 'bpp:browse_lata' %}" class="browse-tile">
                        <div style="padding: 20px; background: #f8f9fa; border-radius: 8px; border: 1px solid #dee2e6; text-align: center; transition: all 0.3s ease; height: 100%;">
                            <i class="fi-calendar" style="font-size: 3rem; color: #ffc107; display: block; margin-bottom: 10px;"></i>
                            <h4 style="color: #2c3e50; margin-bottom: 5px;">Lata</h4>
                            <p style="color: #6c757d; font-size: 0.9rem; margin: 0;">Przeglądaj według roku wydania</p>
                        </div>
                    </a>
                </div>
                <div class="small-12 medium-6 large-3 cell">
                    <a href="/bpp/jednostki/" class="browse-tile">
                        <div style="padding: 20px; background: #f8f9fa; border-radius: 8px; border: 1px solid #dee2e6; text-align: center; transition: all 0.3s ease; height: 100%;">
                            <i class="fi-home" style="font-size: 3rem; color: #dc3545; display: block; margin-bottom: 10px;"></i>
                            <h4 style="color: #2c3e50; margin-bottom: 5px;">Jednostki</h4>
                            <p style="color: #6c757d; font-size: 0.9rem; margin: 0;">Przeglądaj wg jednostki</p>
                        </div>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <style>
    .browse-tile:hover > div {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        background: #fff !important;
    }
    .browse-tile {
        text-decoration: none;
        display: block;
        margin-bottom: 20px;
    }
    </style>

    <div class="grid-x grid-margin-x">
        {% if article %}
            <div class="small-12 large-6 cell">
                <article class="single-article-container">
                    <div class="article-header">
                        <nav class="article-breadcrumb">
                            <a href=".." class="back-link">
                                <i class="fi-arrow-left"></i> Powrót do strony głównej
                            </a>
                        </nav>
                        <h1 class="article-main-title">{{ article.title }}</h1>
                        <div class="article-metadata">
                            <div class="metadata-item">
                                <i class="fi-calendar"></i>
                                <time datetime="{{ article.published_on|date:'Y-m-d' }}">
                                    {{ article.published_on|date:"j E Y, H:i" }}
                                </time>
                            </div>
                            {% if article.author %}
                                <div class="metadata-item">
                                    <i class="fi-torso"></i>
                                    <span>{{ article.author }}</span>
                                </div>
                            {% endif %}
                            {% if request.user.is_superuser or request.user|has_group:"web" %}
                                <div class="metadata-item admin-link">
                                    {% include "browse/go_to_admin_change.html" with group="web" url="admin:miniblog_article_change" pk=article.pk text="<i class='fi-pencil'></i> Edytuj artykuł" %}
                                </div>
                            {% endif %}
                        </div>
                    </div>

                    <div class="article-body">
                        {{ article.article_body.content|safe }}
                    </div>
                </article>
            </div>
        {% else %}
            {% if request.user.is_superuser or request.user|has_group:"web" %}
                <div class="small-12 large-6 cell">
                    <h3 class="section-title">
                        <i class="fi-megaphone section-icon"></i>Aktualności
                    </h3>
                    {% if request.user.is_superuser or request.user|has_group:"web" %}
                        <div class="admin-buttons-centered hide-for-print">
                            <a target="_blank"
                               href="{% url "admin:miniblog_article_changelist" %}"
                               class="button btn-manage">
                                <span class="fi-wrench"></span>
                                Zarządzaj aktualnościami
                            </a>
                            <a target="_blank"
                               href="{% url "admin:miniblog_article_add" %}"
                               class="button btn-add">
                                <span class="fi-page-add"></span>
                                Dodaj artykuł
                            </a>
                        </div>
                    {% endif %}
                    <div class="news-articles">
                        {% for article in miniblog %}
                            <article class="news-article-card">
                                <div class="article-date-badge">
                                    <span class="day">{{ article.published_on|date:"d" }}</span>
                                    <span class="month">{{ article.published_on|date:"M" }}</span>
                                    <span class="year">{{ article.published_on|date:"Y" }}</span>
                                </div>
                                <div class="article-content">
                                    <h4 class="article-title">
                                        <a href="{% url "bpp:browse_artykul" uczelnia.slug article.slug %}">
                                            {{ article.title }}
                                        </a>
                                    </h4>
                                    <div class="article-meta">
                                        <i class="fi-calendar"></i> {{ article.published_on|date:"j E Y" }}
                                    </div>
                                    <div class="article-excerpt">
                                        {{ article.article_body.excerpt|safe }}
                                    </div>
                                    {% if article.article_body.has_more %}
                                        <div class="article-read-more">
                                            <a href="{% url "bpp:browse_artykul" uczelnia.slug article.slug %}" class="read-more-link">
                                                Czytaj więcej <i class="fi-arrow-right"></i>
                                            </a>
                                        </div>
                                    {% endif %}
                                </div>
                            </article>
                        {% empty %}
                            <div class="news-empty-state">
                                <p><i class="fi-page"></i> Brak opublikowanych aktualności.</p>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            {% elif miniblog.exists %}
                <div class="small-12 large-6 cell">
                    <h3 class="section-title">
                        <i class="fi-megaphone section-icon"></i>Aktualności
                    </h3>
                    <div class="news-articles">
                        {% for article in miniblog %}
                            <article class="news-article-card">
                                <div class="article-date-badge">
                                    <span class="day">{{ article.published_on|date:"d" }}</span>
                                    <span class="month">{{ article.published_on|date:"M" }}</span>
                                    <span class="year">{{ article.published_on|date:"Y" }}</span>
                                </div>
                                <div class="article-content">
                                    <h4 class="article-title">
                                        <a href="{% url "bpp:browse_artykul" uczelnia.slug article.slug %}">
                                            {{ article.title }}
                                        </a>
                                    </h4>
                                    <div class="article-meta">
                                        <i class="fi-calendar"></i> {{ article.published_on|date:"j E Y" }}
                                    </div>
                                    <div class="article-excerpt">
                                        {{ article.article_body.excerpt|safe }}
                                    </div>
                                    {% if article.article_body.has_more %}
                                        <div class="article-read-more">
                                            <a href="{% url "bpp:browse_artykul" uczelnia.slug article.slug %}" class="read-more-link">
                                                Czytaj więcej <i class="fi-arrow-right"></i>
                                            </a>
                                        </div>
                                    {% endif %}
                                </div>
                            </article>
                        {% endfor %}
                    </div>
                </div>
            {% endif %}
        {% endif %}
        {% if uczelnia.pokazuj_wydzialy_na_pierwszej_stronie %}
            {% if not article and not miniblog.exists and not request.user.is_superuser and not request.user|has_group:"web" %}
                <div class="small-12 large-12 cell">
                    <h3 class="section-title">
                        <i class="fi-foundation section-icon"></i>Wybierz {% rzeczownik_wydział %}
                    </h3>
                    {% if request.user.is_superuser or request.user|has_group:"struktura" %}
                        <div class="admin-buttons-centered hide-for-print">
                            <a target="_blank"
                               href="{% url "admin:bpp_wydzial_changelist" %}"
                               class="button btn-manage">
                                <span class="fi-wrench"></span>
                                Zarządzaj wydziałami
                            </a>
                            <a target="_blank"
                               href="{% url "admin:bpp_uczelnia_change" uczelnia.pk %}"
                               class="button btn-settings">
                                <span class="fi-widget"></span>
                                Ustawienia dla uczelni
                            </a>
                        </div>
                    {% endif %}
                    <div class="grid-x grid-margin-x">
                        {% for wydzial in uczelnia.wydzialy %}
                            <div class="small-12 medium-6 large-6 cell">
                                <div class="wydzial-card">
                                    <div class="arrow-icon">
                                        <i class="fi-arrow-right"></i>
                                    </div>
                                    <a href="{% url "bpp:browse_wydzial" wydzial.slug %}">
                                        {{ wydzial }}
                                    </a>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            {% else %}
                <div class="small-12 {% if article or miniblog.exists %}large-6{% else %}large-12{% endif %} cell">
                    <h3 class="section-title">
                        <i class="fi-foundation section-icon"></i>Wybierz {% rzeczownik_wydział %}
                    </h3>
                    {% if request.user.is_superuser or request.user|has_group:"struktura" %}
                        <div class="admin-buttons-centered hide-for-print">
                            <a target="_blank"
                               href="{% url "admin:bpp_wydzial_changelist" %}"
                               class="button btn-manage">
                                <span class="fi-wrench"></span>
                                Zarządzaj wydziałami
                            </a>
                            <a target="_blank"
                               href="{% url "admin:bpp_uczelnia_change" uczelnia.pk %}"
                               class="button btn-settings">
                                <span class="fi-widget"></span>
                                Ustawienia dla uczelni
                            </a>
                        </div>
                    {% endif %}
                    {% if not article and not miniblog.exists %}
                        <div class="grid-x grid-margin-x">
                            {% for wydzial in uczelnia.wydzialy %}
                                <div class="small-12 medium-6 large-6 cell">
                                    <div class="wydzial-card">
                                        <div class="arrow-icon">
                                            <i class="fi-arrow-right"></i>
                                        </div>
                                        <a href="{% url "bpp:browse_wydzial" wydzial.slug %}">
                                            {{ wydzial }}
                                        </a>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="wydzial-list">
                            {% for wydzial in uczelnia.wydzialy %}
                                <div class="wydzial-card">
                                    <div class="arrow-icon">
                                        <i class="fi-arrow-right"></i>
                                    </div>
                                    <a href="{% url "bpp:browse_wydzial" wydzial.slug %}">
                                        {{ wydzial }}
                                    </a>
                                </div>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>
            {% endif %}
        {% endif %}
    {% if uczelnia.pokazuj_jednostki_na_pierwszej_stronie %}
        {% if not article and not miniblog.exists and not request.user.is_superuser and not request.user|has_group:"web" %}
            <div class="small-12 large-12 cell">{% load deklinacja %}
                <h3 class="section-title">
                    <i class="fi-home section-icon"></i>Wybierz {% rzeczownik_jednostkę %}
                </h3>
                {% if request.user.is_superuser or request.user|has_group:"struktura" %}
                    <div class="admin-buttons-centered hide-for-print">
                        <a target="_blank"
                           href="{% url "admin:bpp_jednostka_changelist" %}"
                           class="button btn-manage">
                            <span class="fi-wrench"></span>
                            Zarządzaj jednostkami
                        </a>
                        <a target="_blank"
                           href="{% url "admin:bpp_uczelnia_change" uczelnia.pk %}"
                           class="button btn-settings">
                            <span class="fi-widget"></span>
                            Ustawienia dla uczelni
                        </a>
                    </div>
                {% endif %}
                <div class="grid-x grid-margin-x">
                    {% for jednostka in uczelnia.jednostki %}
                        <div class="small-12 medium-6 large-6 cell">
                            <div class="jednostka-card-main">
                                <div class="arrow-icon">
                                    <i class="fi-arrow-right"></i>
                                </div>
                                <a href="{% url "bpp:browse_jednostka" jednostka.slug %}">
                                    {{ jednostka }}
                                </a>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
        {% else %}
            <div class="small-12 {% if article or miniblog.exists %}large-6{% else %}large-12{% endif %} cell">{% load deklinacja %}
                <h3 class="section-title">
                    <i class="fi-home section-icon"></i>Wybierz {% rzeczownik_jednostkę %}
                </h3>
                {% if request.user.is_superuser or request.user|has_group:"struktura" %}
                    <div class="admin-buttons-centered hide-for-print">
                        <a target="_blank"
                           href="{% url "admin:bpp_jednostka_changelist" %}"
                           class="button btn-manage">
                            <span class="fi-wrench"></span>
                            Zarządzaj jednostkami
                        </a>
                        <a target="_blank"
                           href="{% url "admin:bpp_uczelnia_change" uczelnia.pk %}"
                           class="button btn-settings">
                            <span class="fi-widget"></span>
                            Ustawienia dla uczelni
                        </a>
                    </div>
                {% endif %}
                {% if not article and not miniblog.exists %}
                    <div class="grid-x grid-margin-x">
                        {% for jednostka in uczelnia.jednostki %}
                            <div class="small-12 medium-6 large-6 cell">
                                <div class="jednostka-card-main">
                                    <div class="arrow-icon">
                                        <i class="fi-arrow-right"></i>
                                    </div>
                                    <a href="{% url "bpp:browse_jednostka" jednostka.slug %}">
                                        {{ jednostka }}
                                    </a>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="jednostka-list">
                        {% for jednostka in uczelnia.jednostki %}
                            <div class="jednostka-card-main">
                                <div class="arrow-icon">
                                    <i class="fi-arrow-right"></i>
                                </div>
                                <a href="{% url "bpp:browse_jednostka" jednostka.slug %}">
                                    {{ jednostka }}
                                </a>
                            </div>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
        {% endif %}
    {% endif %}
    </div>

    <!-- Poznaj Bibliografię Publikacji Pracowników Section -->
    <div class="grid-x grid-margin-x">
        <div class="small-12 cell">
            <div class="funkcja-dnia-container light-theme">
                <div class="grid-x align-middle">
                    <div class="small-12 medium-auto cell">
                        <h3>
                            <i class="fi-star"></i>Poznaj Bibliografię Publikacji Pracowników
                        </h3>
                    </div>
                </div>
                <div class="grid-x">
                    <div class="small-12 cell">
                        <div id="daily-feature-content">
                            <!-- Content will be inserted by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // Functions for anonymous users
        const anonymousFeatures = [
            {
                name: "Wyszukiwarka zaawansowana",
                description: "Potężne narzędzie do przeszukiwania bazy publikacji według wielu kryteriów: autor, tytuł, rok wydania, jednostka, typ publikacji i wiele innych. Pozwala na tworzenie złożonych zapytań z operatorami logicznymi.",
                link: "/multiseek/",
                icon: "fi-magnifying-glass"
            },
            {
                name: "Formularz wyszukiwania (Multiseek)",
                description: "Zaawansowany kreator zapytań umożliwiający budowanie skomplikowanych wyszukiwań krok po kroku. Idealne narzędzie do precyzyjnego filtrowania wyników według dowolnych kombinacji parametrów.",
                link: "/multiseek/",
                icon: "fi-page-search"
            },
            {
                name: "Przeglądanie jednostek",
                description: "Hierarchiczny widok struktury organizacyjnej uczelni. Pozwala na nawigację po wydziałach, instytutach i katedrach wraz z przypisanymi do nich publikacjami.",
                link: "/bpp/jednostki/",
                icon: "fi-home"
            },
            {
                name: "Przeglądanie autorów",
                description: "Alfabetyczna lista wszystkich autorów w systemie. Umożliwia szybkie znalezienie profilu autora i przeglądanie jego dorobku naukowego.",
                link: "/bpp/autor/",
                icon: "fi-torsos-all"
            },
            {
                name: "Przeglądanie źródeł",
                description: "Kompletna lista czasopism naukowych i źródeł publikacji. Zawiera informacje o punktacji, współczynnikach wpływu oraz przynależności do list ministerialnych.",
                link: "/bpp/zrodlo/",
                icon: "fi-book"
            },
            {% if uczelnia.pokazuj_wydzialy %}
            {
                name: "Przeglądanie wydziałów",
                description: "Struktura wydziałowa uczelni z możliwością przeglądania jednostek i publikacji przypisanych do każdego wydziału.",
                link: "/bpp/wydzial/",
                icon: "fi-foundation"
            },
            {% endif %}
            {
                name: "Ranking autorów",
                description: "Zestawienie najbardziej produktywnych naukowców według różnych kryteriów: liczby publikacji, punktacji, cytowań. Pozwala na analizę dorobku w wybranych okresach.",
                link: "/bpp/ranking-autorow/",
                icon: "fi-trophy"
            }
        ];

        // Additional functions for logged-in users
        const loggedInFeatures = [
            {
                name: "Komparator PBN",
                description: "Narzędzie do porównywania danych lokalnych z Polską Bibliografią Naukową. Pomaga wykryć różnice i synchronizować informacje o publikacjach między systemami.",
                link: "/pbn_api/komparator/",
                icon: "fi-arrows-compress"
            },
            {
                name: "Eksport do PBN",
                description: "Funkcja eksportująca wybrane publikacje do formatu zgodnego z Polską Bibliografią Naukową. Automatyzuje proces raportowania publikacji do systemu ministerialnego.",
                link: "/pbn_api/eksport/",
                icon: "fi-upload"
            },
            {
                name: "Import z systemu POLON",
                description: "Moduł importujący dane o publikacjach bezpośrednio z systemu POL-on. Oszczędza czas przy wprowadzaniu danych już istniejących w systemie ministerialnym.",
                link: "/import_polon/",
                icon: "fi-download"
            },
            {
                name: "Raport slotów - Ewaluacja",
                description: "Kompleksowy raport slotów publikacyjnych dla potrzeb ewaluacji jednostek naukowych. Automatycznie wylicza punkty i sloty zgodnie z obowiązującymi przepisami.",
                link: "/raport-slotow/",
                icon: "fi-graph-bar"
            },
            {
                name: "Raport slotów autora",
                description: "Indywidualny raport pokazujący wkład punktowy i sloty konkretnego autora. Pomocny przy ocenach pracowniczych i awansach naukowych.",
                link: "/raport-slotow/autor/",
                icon: "fi-torso"
            },
            {
                name: "Raport slotów zerowy",
                description: "Specjalny raport identyfikujący publikacje bez przypisanych slotów lub z zerowymi punktami. Pomaga w wykrywaniu błędów i uzupełnianiu brakujących danych.",
                link: "/raport-slotow/zerowy/",
                icon: "fi-alert"
            },
            {
                name: "Komparator udziałów PBN",
                description: "Narzędzie porównujące udziały procentowe autorów w publikacjach między systemem lokalnym a PBN. Wykrywa i pomaga korygować niezgodności w deklaracjach autorskich.",
                link: "/komparator-pbn-udzialy/",
                icon: "fi-percent"
            },
            {
                name: "Zgłoś publikację",
                description: "Formularz do zgłaszania nowych publikacji do bazy. Umożliwia autorom samodzielne wprowadzanie swoich prac do systemu bibliograficznego.",
                link: "/zglos_publikacje/nowe_zgloszenie/",
                icon: "fi-page-add"
            },
            {
                name: "Oświadczenia autorów",
                description: "System zarządzania oświadczeniami dotyczącymi przypisania publikacji do dyscyplin naukowych. Kluczowe dla prawidłowej ewaluacji jednostek.",
                link: "/oswiadczenia/",
                icon: "fi-clipboard-notes"
            },
            {
                name: "Import list ministerialnych",
                description: "Narzędzie do aktualizacji list czasopism punktowanych MEiN. Automatycznie pobiera i integruje najnowsze wykazy ministerialne.",
                link: "/import_list_ministerialnych/",
                icon: "fi-list-thumbnails"
            },
            {
                name: "Import list IF",
                description: "Moduł importujący współczynniki Impact Factor z baz Clarivate Analytics. Aktualizuje wartości IF dla czasopism w systemie.",
                link: "/import_list_if/",
                icon: "fi-graph-trend"
            },
            {
                name: "Import dyscyplin",
                description: "Funkcja importująca i aktualizująca słownik dyscyplin naukowych zgodnie z klasyfikacją ministerialną.",
                link: "/import_dyscyplin/",
                icon: "fi-folder"
            },
            {
                name: "Rozbieżności dyscyplin",
                description: "Raport wykrywający niezgodności w przypisaniu publikacji do dyscyplin naukowych. Pomaga w weryfikacji poprawności deklaracji.",
                link: "/rozbieznosci_dyscyplin/",
                icon: "fi-x-circle"
            },
            {
                name: "Rozbieżności IF",
                description: "Analiza różnic między wartościami Impact Factor w systemie lokalnym a bazami zewnętrznymi. Wykrywa błędy i nieaktualne dane.",
                link: "/rozbieznosci_if/",
                icon: "fi-shuffle"
            },
            {
                name: "Nowe raporty",
                description: "Zaawansowany moduł raportowania z możliwością tworzenia własnych zestawień i eksportu danych do różnych formatów.",
                link: "/nowe_raporty/",
                icon: "fi-page-export"
            },
            {
                name: "Zmiana hasła",
                description: "Panel zmiany hasła do konta w systemie BPP. Regularna zmiana hasła zwiększa bezpieczeństwo Twoich danych.",
                link: "/password_change/",
                icon: "fi-key"
            },
            {
                name: "Import pracowników",
                description: "Masowy import danych o pracownikach z plików Excel lub CSV. Przyspiesza proces wprowadzania nowych autorów do systemu.",
                link: "/import_pracownikow/",
                icon: "fi-torsos"
            }
        ];

        // Check if user is authenticated
        const isAuthenticated = {% if request.user.is_authenticated %}true{% else %}false{% endif %};

        // Combine anonymous features with logged-in features if authenticated
        let features = anonymousFeatures;
        if (isAuthenticated) {
            // For logged-in users, show all features
            features = [...anonymousFeatures, ...loggedInFeatures];
        }

        // Get today's date and use it as seed for deterministic selection
        const today = new Date();
        const dayOfYear = Math.floor((today - new Date(today.getFullYear(), 0, 0)) / 1000 / 60 / 60 / 24);
        const featureIndex = dayOfYear % features.length;
        const todayFeature = features[featureIndex];

        // Display the feature
        const contentDiv = document.getElementById('daily-feature-content');
        if (contentDiv && todayFeature) {
            contentDiv.innerHTML = `
                <div class="grid-x align-middle">
                    <div class="small-12 medium-2 large-1 cell text-center">
                        <i class="${todayFeature.icon} feature-icon"></i>
                    </div>
                    <div class="small-12 medium-10 large-11 cell feature-content">
                        <h4>${todayFeature.name}</h4>
                        <p>${todayFeature.description}</p>
                        <a href="${todayFeature.link}" class="feature-button">
                            <i class="fi-arrow-right"></i>Odkryj tę funkcję
                        </a>
                    </div>
                </div>
            `;
        }
    });
    </script>

    {% if recently_updated or recent_abstracts %}
        <div class="grid-x grid-margin-x">
            {% if recently_updated %}
                {% cache 3600 recent_publications uczelnia.pk %}
                <div class="small-12 large-6 cell">
                    <h3 class="section-title" style="margin-top: 30px;">
                        <i class="fi-book section-icon"></i>Niedawno zaktualizowane rekordy
                    </h3>
                    <ul class="no-bullet">
                        {% for rekord in recently_updated %}
                            <li class="recent-publication-item">
                                <a href="{{ rekord.get_absolute_url }}">
                                    {{ rekord.opis_bibliograficzny_cache|safe }}
                                </a>
                                <div class="publication-meta">
                                    {{ rekord.ostatnio_zmieniony|date:"d.m.Y H:i" }}
                                    {% if rekord.rok %} &bull; {{ rekord.rok }}{% endif %}
                                </div>
                            </li>
                        {% endfor %}
                    </ul>
                    <div class="text-center" style="margin-top: 15px;">
                        <a href="/multiseek/" class="button secondary expanded">Zobacz wszystkie publikacje</a>
                        <a href="{% url 'bpp:browse_lata' %}" class="button primary expanded" style="margin-top: 10px;">
                            <i class="fi-calendar"></i> Przeglądaj publikacje według roku
                        </a>
                    </div>
                </div>
                {% endcache %}
            {% endif %}

            {% if recent_abstracts %}
                {% cache 3600 recent_abstracts uczelnia.pk %}
                <div class="small-12 large-6 cell">
                    <h3 class="section-title" style="margin-top: 30px;">
                        <i class="fi-page-multiple section-icon"></i>Najnowsze rekordy ze streszczeniem
                    </h3>
                    <ul class="no-bullet">
                        {% for rekord in recent_abstracts %}
                            <li class="recent-abstract-item">
                                <a href="{{ rekord.rekord.get_absolute_url }}">
                                    {{ rekord.rekord.opis_bibliograficzny_cache|safe }}
                                </a>
                                <div class="abstract-content">
                                    {{ rekord.streszczenie|safe|truncatewords:130 }}
                                </div>
                                <div class="abstract-meta">
                                    {{ rekord.ostatnio_zmieniony|date:"d.m.Y H:i" }}
                                    {% if rekord.rok %} &bull; {{ rekord.rok }}{% endif %}
                                </div>
                            </li>
                        {% endfor %}
                    </ul>
                </div>
                {% endcache %}
            {% endif %}
        </div>
    {% endif %}

{% endblock %}
