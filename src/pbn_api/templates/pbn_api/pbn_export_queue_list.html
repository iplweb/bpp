{% extends "base.html" %}
{% load humanize static %}

{% block extratitle %}
    Kolejka eksportu do PBN
{% endblock %}

{% block extrahead %}
<style>
    /* Remove underlines from clickable table rows in export queue only */
    #export-queue-table tr[onclick] td a,
    #export-queue-table tr[onclick] td a:hover,
    #export-queue-table tr[onclick] td a:focus,
    #export-queue-table tr[onclick] td a:visited {
        text-decoration: none !important;
    }
</style>
{% endblock %}

{% block breadcrumbs %}
    {{ block.super }}
    <li class="current">Kolejka eksportu do PBN</li>
{% endblock %}

{% block content %}
    <h2>Kolejka eksportu do PBN</h2>

    {% if request.user.is_staff or perms.pbn_api %}
        <hr>

        <h4>Filtry</h4>
        <div class="button-group">
            <a href="?" class="button {% if current_filter == 'all' %}primary{% else %}secondary{% endif %}">
                <span class="fi-list"></span> Wszystkie
            </a>
            <a href="?zakonczono_pomyslnie=true" class="button {% if current_filter == 'true' %}success{% else %}secondary{% endif %}">
                <span class="fi-check"></span> Zakończone pomyślnie
            </a>
            <a href="?zakonczono_pomyslnie=false" class="button {% if current_filter == 'false' %}alert{% else %}secondary{% endif %}">
                <span class="fi-x"></span> Zakończone z błędem
            </a>
            <a href="?zakonczono_pomyslnie=none" class="button {% if current_filter == 'none' %}warning{% else %}secondary{% endif %}">
                <span class="fi-clock"></span> W trakcie/oczekujące
            </a>
        </div>

        <hr>

        <div id="export-queue-table"
             hx-get="{% url 'pbn_api:export-queue-table' %}{% if request.GET.zakonczono_pomyslnie %}?zakonczono_pomyslnie={{ request.GET.zakonczono_pomyslnie }}{% endif %}"
             hx-trigger="every 5s"
             hx-swap="innerHTML">
            {% include 'pbn_api/pbn_export_queue_table.html' %}
        </div>

        <div class="text-center" style="margin-top: 10px;">
            <small class="text-muted">
                <span class="fi-refresh"></span> Tabela odświeża się automatycznie co 5 sekund
            </small>
        </div>
    {% else %}
        <p class="alert-box alert">Brak uprawnień do przeglądania kolejki eksportu.</p>
    {% endif %}

{% endblock %}
