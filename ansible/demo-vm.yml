---
- hosts: staging
  become: yes
  become_method: sudo
  roles:

  tasks: 
    - name: "** NIE UŻYWAĆ NA PRODUKCJI ** Hasło domyślnego użytkownika zmienione"
      user: name={{ django_user }} password="$6$7/YB0MRvn.ff5520$NHkjQSbz.gR0Q1wkrmOAZ.T94.iBiVZgQsfJuPVt.SK9OOAW7EajtlS9Hq4JUeyQPj.JBhJdiYhWtsWk6kQdt/"
     
    - name: "** NIE UŻYWAĆ NA PRODUKCJI ** Domyślny użytkownik systemu zostaje utworzony"
      shell: ./vexec python latest/src/manage.py createsuperuser --email michal.dtz@gmail.com --username admin --noinput

    - name: "** NIE UŻYWAĆ NA PRODUKCJI ** Hasło domyślnego użytkownika systemu zostaje ustalone"
      shell:  ../../vexec python -c  "from bpp.models import BppUser; u = BppUser.objects.all()[0]; u.set_password('admin'); u.save()"
      args:
        chdir: ./latest/src/

    - name: "** NIE UŻYWAĆ NA PRODUKCJI ** Wpuszczamy wszystkie hosty"
      lineinfile: name=latest/src/django_bpp/settings/base.py line="ALLOWED_HOSTS.append('*')"

    - name: supervisor restart
      shell: supervisorctl restart all
