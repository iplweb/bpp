- name: "{{ django_venv_dir }}/bin/activate script contains proper environment variables"
  lineinfile: dest={{ django_venv_dir }}/bin/activate line="{{ item }}"
  no_log: True
  with_items:
    - export {{ django_envvar_prefix }}_HOSTNAME="{{ django_hostname }}"
    - export {{ django_envvar_prefix }}_SECRET_KEY="{{ django_secret_key }}"
    - export {{ django_envvar_prefix }}_DB_NAME="{{ django_db_name }}"
    - export {{ django_envvar_prefix }}_DB_USER="{{ django_db_user }}"
    - export {{ django_envvar_prefix }}_DB_PASSWORD="{{ django_db_password }}"
    - export {{ django_envvar_prefix }}_DB_HOST="{{ django_db_host }}"
    - export {{ django_envvar_prefix }}_DB_PORT="{{ django_db_port }}"
    - export PGDATABASE="{{ django_db_name}}"
    - export PGUSER="{{ django_db_user}}"
    - export PGPASSWORD="{{ django_db_password}}"
    - export PGHOST="{{ django_db_host }}"
    - export PGPORT="{{ django_db_port}}"
    - export DJANGO_SETTINGS_MODULE="{{ django_settings_module }}"

- name: RAVEN_CONFIG_URL is set, if enabled
  lineinfile: dest={{ django_venv_dir }}/bin/activate line="{{ item }}" 
  with_items:
    - export {{ django_envvar_prefix }}_RAVEN_CONFIG_URL="{{ django_raven_url }}"
  when: django_enable_raven

- name: RAVEN_CONFIG_URL is removed, if not enabled
  lineinfile: dest={{ django_venv_dir }}/bin/activate line="{{ item }}" state=absent
  with_items:
    - export {{ django_envvar_prefix }}_RAVEN_CONFIG_URL="{{ django_raven_url }}"
  when: not django_enable_raven

