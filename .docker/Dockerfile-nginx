FROM ubuntu:16.04

RUN apt-get update -qq && apt-get install -qq -y \
  software-properties-common 

# This fails because UnicodeBug (I have an 'Å‚' in my first name...)
RUN add-apt-repository -y "ppa:dotz/nginx-with-push-stream-module" || true

RUN apt-get update -qq \ 
  && DEBIAN_FRONTEND=noninteractive apt-get install -qq -y --allow-unauthenticated \
     nginx-full=1.12.0-1+xenial1+pushtream0

COPY default /etc/nginx/sites-available
COPY nginx.conf /etc/nginx/

EXPOSE 80

RUN nginx -t

ENTRYPOINT nginx && tail -f /var/log/nginx/*